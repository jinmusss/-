<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金木常胜日志 - 交易分析</title>
    <!-- 引入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Font Awesome for futuristic icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- 引入 Chart.js 及其日期适配器用于图表绘制 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <style>
        /* 使用 Inter 字体并设置深色背景，符合前卫设计 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d18; /* 极深蓝黑 */
            color: #e2e8f0; /* 默认文字颜色 */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 核心动画效果：霓虹光晕 */
        .neon-glow {
            box-shadow: 0 0 10px rgba(0, 220, 255, 0.6), 0 0 20px rgba(0, 220, 255, 0.4);
            transition: all 0.3s ease;
        }
        .neon-glow:hover {
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.6);
        }

        /* 突出按钮的渐变与动态效果 */
        .cyber-button {
            background-image: linear-gradient(90deg, #00d4ff, #8338ec);
            color: white;
            font-weight: bold;
            letter-spacing: 0.05em;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .cyber-button:hover {
            box-shadow: 0 0 15px rgba(131, 56, 236, 0.8);
            transform: translateY(-2px);
        }

        /* 动画组件的背景 */
        .component-bg {
            background-color: #1a1a2e; /* 深紫蓝 */
            border: 1px solid #2d2d4c;
        }

        /* 突出显示盈利（绿色/青色）和亏损（粉色/红色） */
        .metric-profit { border-bottom: 4px solid #10b981; }
        .metric-drawdown { border-bottom: 4px solid #ec4899; }
        .metric-neutral { border-bottom: 4px solid #06b6d4; }
        
        /* 模态框背景 */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
    </style>
</head>
<body class="selection:bg-cyan-600 selection:text-black">

    <!-- 主容器 -->
    <div id="app" class="p-4 md:p-8 max-w-7xl mx-auto w-full flex-grow">

        <!-- 头部 - 品牌与状态 -->
        <header class="mb-8 border-b border-cyan-400/30 pb-4 flex justify-between items-center flex-wrap gap-4">
            <div class="flex items-center space-x-4">
                <i class="fas fa-book-open text-4xl text-cyan-400 neon-glow"></i>
                <h1 class="text-3xl md:text-4xl font-extrabold tracking-wider text-white">
                    <span class="text-cyan-400">JINMU</span> ALWAYS WIN
                </h1>
            </div>
            <div class="flex items-center space-x-3 text-sm">
                <!-- 新增初始资金输入框 -->
                <div class="flex items-center space-x-2 bg-[#252542] p-2 rounded-lg">
                    <label for="initial-capital" class="text-xs text-gray-400">初始资金 ($):</label>
                    <input type="number" id="initial-capital" value="10000" min="1" step="100" 
                           class="w-24 p-0.5 text-right rounded bg-transparent border-none text-white focus:ring-0 focus:outline-none" 
                           onchange="saveInitialCapital(this.value)" />
                </div>
                
                <span id="user-id-display" class="px-3 py-1 rounded-full text-xs font-semibold bg-[#8338ec] text-white">用户ID: 载入中...</span>
                <i class="fas fa-user-circle text-2xl text-gray-500"></i>
            </div>
        </header>

        <!-- 主仪表板 -->
        <main id="dashboard-view">
            <h2 class="text-2xl font-bold mb-6 text-gray-100 border-l-4 border-emerald-400 pl-3">
                <i class="fas fa-tachometer-alt mr-2 text-emerald-400"></i>
                交易性能分析仪表板
            </h2>

            <!-- 仪表板顶部操作区 (包含交易日志筛选) -->
            <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                <!-- 交易日志筛选区域 -->
                <div class="flex items-center space-x-4 text-sm">
                    <div class="flex items-center space-x-2">
                        <label for="month-year-filter" class="text-sm text-gray-400">交易日志筛选:</label>
                        <select id="month-year-filter" class="px-3 py-2 rounded-lg bg-[#252542] text-gray-300 border border-[#44447a] focus:ring-cyan-400 focus:border-cyan-400 text-sm" onchange="applyLogFilter(this.value)">
                            <option value="all">显示全部记录</option>
                            <!-- Options will be generated by JS -->
                        </select>
                    </div>
                    <button class="px-4 py-2 rounded-lg bg-[#252542] text-gray-300 hover:bg-cyan-600/50 transition">
                        <i class="fas fa-tag mr-1"></i> 按模型筛选 (待开发)
                    </button>
                </div>
                <!-- 新增交易按钮 -->
                <button onclick="openTradeModal()" class="cyber-button px-6 py-2 rounded-full text-md shadow-lg">
                    <i class="fas fa-plus mr-2"></i>
                    记录新交易
                </button>
            </div>

            <!-- 核心性能指标卡片 (TradeZella Metrics) -->
            <div id="metrics-container" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
                <!-- 指标卡片将通过 JS 动态生成 -->
            </div>
            
            <!-- 资产净值曲线图表 (Equity Curve Chart) -->
            <div class="p-6 rounded-xl component-bg shadow-2xl mb-8">
                <h3 class="text-xl font-semibold mb-4 text-gray-100 border-l-2 border-pink-500 pl-2">
                    <i class="fas fa-chart-area mr-1 text-pink-500"></i> 账户资产净值曲线 (Equity Curve)
                </h3>
                
                <!-- 时间过滤器 -->
                <div class="flex space-x-2 mb-4 text-sm flex-wrap gap-2" id="time-filters">
                    <button data-filter="all" class="filter-button px-3 py-1 rounded-full bg-cyan-600/70 text-white font-semibold shadow-md transition">
                        <i class="fas fa-history mr-1"></i> 全部记录
                    </button>
                    <button data-filter="year" class="filter-button px-3 py-1 rounded-full bg-[#252542] text-gray-300 hover:bg-cyan-600/50 transition">
                        <i class="fas fa-calendar-alt mr-1"></i> 今年
                    </button>
                    <button data-filter="month" class="filter-button px-3 py-1 rounded-full bg-[#252542] text-gray-300 hover:bg-cyan-600/50 transition">
                        <i class="fas fa-calendar-day mr-1"></i> 本月
                    </button>
                    <button data-filter="week" class="filter-button px-3 py-1 rounded-full bg-[#252542] text-gray-300 hover:bg-cyan-600/50 transition">
                        <i class="fas fa-calendar-week mr-1"></i> 本周
                    </button>
                </div>

                <div class="h-96">
                    <canvas id="equity-chart"></canvas>
                </div>
            </div>

            <!-- 交易日志区域 -->
            <div class="p-6 rounded-xl component-bg shadow-2xl overflow-x-auto">
                <h3 class="text-xl font-semibold mb-4 text-gray-100 border-l-2 border-cyan-400 pl-2">
                    <i class="fas fa-clipboard-list mr-1"></i> 交易记录 (Total: <span id="trade-count">0</span>)
                </h3>
                
                <table class="min-w-full divide-y divide-[#44447a]">
                    <thead class="bg-[#252542] text-xs uppercase tracking-wider">
                        <tr>
                            <th class="px-6 py-3 text-left font-medium text-gray-300">时间</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-300">交易对</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-300">方向</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-300">R值 (风险回报)</th>
                            <th class="px-6 py-3 text-right font-medium text-gray-300">绝对盈亏 ($)</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-300">图表/日志</th>
                        </tr>
                    </thead>
                    <tbody id="trade-log-body" class="divide-y divide-[#44447a] text-sm">
                        <!-- 交易数据将通过 JS 动态加载 -->
                        <tr>
                            <td colspan="6" class="p-6 text-center text-gray-500 italic" id="log-status">
                                <i class="fas fa-circle-notch fa-spin mr-2"></i> 正在从数据矩阵载入交易数据...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </main>
        
    </div>

    <!-- 模态框: 记录新交易 -->
    <div id="trade-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="component-bg p-8 rounded-xl shadow-neon-lg w-full max-w-xl mx-4">
            <h3 class="text-2xl font-bold mb-6 text-cyan-400 border-b border-cyan-400/50 pb-2">
                <i class="fas fa-clipboard-check mr-2"></i> 记录新交易日志
            </h3>
            <form id="trade-form" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <!-- 交易对 -->
                    <div>
                        <label for="symbol" class="block text-sm font-medium mb-1 text-gray-300">交易对 (Symbol)</label>
                        <input type="text" id="symbol" value="BTC/USDT" required class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    </div>
                    <!-- 日期 -->
                    <div>
                        <label for="trade-date" class="block text-sm font-medium mb-1 text-gray-300">日期</label>
                        <input type="date" id="trade-date" required class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4">
                    <!-- 方向 -->
                    <div>
                        <label for="side" class="block text-sm font-medium mb-1 text-gray-300">方向</label>
                        <select id="side" required class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400">
                            <option value="LONG">多头 (LONG)</option>
                            <option value="SHORT">空头 (SHORT)</option>
                        </select>
                    </div>
                    <!-- R值 -->
                    <div>
                        <label for="r-multiple" class="block text-sm font-medium mb-1 text-gray-300">R值 (例如: 2.5)</label>
                        <input type="number" step="0.1" id="r-multiple" required placeholder="1.0" class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    </div>
                    <!-- 绝对盈亏 -->
                    <div>
                        <label for="pnl-amount" class="block text-sm font-medium mb-1 text-gray-300">绝对盈亏 ($)</label>
                        <input type="number" step="0.01" id="pnl-amount" required placeholder="500.00" class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    </div>
                </div>

                <!-- 裸K模型标签 (模拟 TradeZella Tagging) -->
                <div>
                    <label for="model-tag" class="block text-sm font-medium mb-1 text-gray-300">裸K模型标签 (e.g., Fractal Breakout)</label>
                    <input type="text" id="model-tag" placeholder="分形突破" class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                </div>
                
                <!-- TradingView 图表链接/ID (核心功能) -->
                <div>
                    <label for="chart-link" class="block text-sm font-medium mb-1 text-gray-300">TradingView 图表链接/ID</label>
                    <input type="url" id="chart-link" placeholder="https://www.tradingview.com/chart/..." class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    <p class="text-xs text-gray-500 mt-1">方便您回顾裸K结构和入场位置。</p>
                </div>
                
                <!-- 心理/总结日志 -->
                <div>
                    <label for="notes" class="block text-sm font-medium mb-1 text-gray-300">交易心理/总结 (Journaling)</label>
                    <textarea id="notes" rows="3" placeholder="入场时感觉过于自信，但按计划执行，R值计算准确。" class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"></textarea>
                </div>
                
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeTradeModal()" class="px-6 py-2 rounded-full border border-gray-600 text-gray-300 hover:border-pink-500 hover:text-pink-500 transition">
                        取消
                    </button>
                    <button type="submit" class="cyber-button px-6 py-2 rounded-full">
                        <i class="fas fa-save mr-1"></i> 保存交易
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 模态框: 交易详情 (Read-Only View) -->
    <div id="detail-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="component-bg p-8 rounded-xl shadow-neon-lg w-full max-w-3xl mx-4">
            <h3 class="text-2xl font-bold mb-6 text-emerald-400 border-b border-emerald-400/50 pb-2">
                <i class="fas fa-eye mr-2"></i> 交易详情和日志
            </h3>
            <div id="detail-content" class="space-y-4 text-gray-200">
                <!-- 详情内容将通过 JS 动态填充 -->
            </div>
            <div class="flex justify-end pt-6">
                <!-- 按钮区域，包含 '编辑' 和 '关闭' 按钮 -->
            </div>
        </div>
    </div>
    
    <!-- 模态框: 编辑交易 (Editable View) -->
    <div id="edit-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="component-bg p-8 rounded-xl shadow-neon-lg w-full max-w-xl mx-4">
            <h3 class="text-2xl font-bold mb-6 text-emerald-400 border-b border-emerald-400/50 pb-2">
                <i class="fas fa-edit mr-2"></i> 修改交易日志
            </h3>
            <form id="edit-form" class="space-y-4">
                <!-- Hidden ID field to know which doc to update -->
                <input type="hidden" id="edit-trade-id" /> 
                
                <div class="grid grid-cols-2 gap-4">
                    <!-- 交易对 -->
                    <div>
                        <label for="edit-symbol" class="block text-sm font-medium mb-1 text-gray-300">交易对 (Symbol)</label>
                        <input type="text" id="edit-symbol" required class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    </div>
                    <!-- 日期 -->
                    <div>
                        <label for="edit-trade-date" class="block text-sm font-medium mb-1 text-gray-300">日期</label>
                        <input type="date" id="edit-trade-date" required class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4">
                    <!-- 方向 -->
                    <div>
                        <label for="edit-side" class="block text-sm font-medium mb-1 text-gray-300">方向</label>
                        <select id="edit-side" required class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400">
                            <option value="LONG">多头 (LONG)</option>
                            <option value="SHORT">空头 (SHORT)</option>
                        </select>
                    </div>
                    <!-- R值 -->
                    <div>
                        <label for="edit-r-multiple" class="block text-sm font-medium mb-1 text-gray-300">R值 (例如: 2.5)</label>
                        <input type="number" step="0.1" id="edit-r-multiple" required class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    </div>
                    <!-- 绝对盈亏 -->
                    <div>
                        <label for="edit-pnl-amount" class="block text-sm font-medium mb-1 text-gray-300">绝对盈亏 ($)</label>
                        <input type="number" step="0.01" id="edit-pnl-amount" required class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                    </div>
                </div>

                <!-- 裸K模型标签 -->
                <div>
                    <label for="edit-model-tag" class="block text-sm font-medium mb-1 text-gray-300">裸K模型标签</label>
                    <input type="text" id="edit-model-tag" placeholder="分形突破" class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                </div>
                
                <!-- TradingView 图表链接/ID -->
                <div>
                    <label for="edit-chart-link" class="block text-sm font-medium mb-1 text-gray-300">TradingView 图表链接/ID</label>
                    <input type="url" id="edit-chart-link" placeholder="https://www.tradingview.com/chart/..." class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400" />
                </div>
                
                <!-- 心理/总结日志 -->
                <div>
                    <label for="edit-notes" class="block text-sm font-medium mb-1 text-gray-300">交易心理/总结 (Journaling)</label>
                    <textarea id="edit-notes" rows="3" placeholder="入场时感觉过于自信，但按计划执行，R值计算准确。" class="w-full p-2 rounded-lg bg-[#252542] border border-[#44447a] focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400"></textarea>
                </div>
                
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeEditModal()" class="px-6 py-2 rounded-full border border-gray-600 text-gray-300 hover:border-pink-500 hover:text-pink-500 transition">
                        取消
                    </button>
                    <button type="submit" class="cyber-button px-6 py-2 rounded-full bg-emerald-500 hover:bg-emerald-600">
                        <i class="fas fa-save mr-1"></i> 更新交易
                    </button>
                </div>
            </form>
        </div>
    </div>


    <script type="module">
        // --- Firestore & Firebase Configuration ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, query, serverTimestamp, updateDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-cyber-logbook';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let userId = null;
        let isAuthReady = false;
        let trades = [];
        let INITIAL_CAPITAL = 10000; // 初始模拟资金 (现在是动态的)
        let currentLogFilter = 'all'; // 当前交易日志筛选值
        
        // Charting variables
        let equityChartInstance = null;

        // UI Elements
        const tradeModal = document.getElementById('trade-modal');
        const detailModal = document.getElementById('detail-modal');
        const editModal = document.getElementById('edit-modal'); // New: Edit modal
        const tradeForm = document.getElementById('trade-form');
        const editForm = document.getElementById('edit-form'); // New: Edit form
        const tradeLogBody = document.getElementById('trade-log-body');
        const logStatus = document.getElementById('log-status');
        const tradeCountSpan = document.getElementById('trade-count');
        const metricsContainer = document.getElementById('metrics-container');
        const userIdDisplay = document.getElementById('user-id-display');
        const initialCapitalInput = document.getElementById('initial-capital'); // New: Initial Capital Input

        // --- Firebase Initialization and Authentication ---
        async function firebaseInit() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Set up authentication listener
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        userIdDisplay.textContent = `用户ID: ${userId}`;
                        console.log("Firebase Auth Ready. User ID:", userId);
                        await loadInitialCapital(); // 1. 加载初始资金
                        loadTrades(); // 2. 加载交易记录
                    } else {
                        // Attempt to sign in with custom token or anonymously
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                logStatus.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i> 数据库连接失败: ${error.message}`;
            }
        }

        // --- Initial Capital Persistence ---
        async function loadInitialCapital() {
            if (!isAuthReady || !userId) return INITIAL_CAPITAL;
            
            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'settings', 'initial_balance');
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists() && docSnap.data().capital) {
                    const storedCapital = docSnap.data().capital;
                    INITIAL_CAPITAL = storedCapital;
                    initialCapitalInput.value = storedCapital;
                    return storedCapital;
                }
            } catch (error) {
                console.error("Error loading initial capital:", error);
            }
            initialCapitalInput.value = INITIAL_CAPITAL; // Fallback to default
            return INITIAL_CAPITAL;
        }

        async function saveInitialCapital(newCapital) {
            if (!isAuthReady || !userId) return;

            newCapital = parseFloat(newCapital);
            if (isNaN(newCapital) || newCapital <= 0) {
                // If invalid input, reset the input field to the current valid value
                initialCapitalInput.value = INITIAL_CAPITAL;
                return;
            }
            
            INITIAL_CAPITAL = newCapital;
            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'settings', 'initial_balance');
            try {
                await setDoc(docRef, { capital: newCapital, timestamp: serverTimestamp() }, { merge: false });
                console.log("Initial capital saved:", newCapital);
                // 重新计算并渲染所有数据
                updateChartAndMetrics(trades); 
            } catch (error) {
                console.error("Error saving initial capital:", error);
                // 可以在 UI 上显示一个临时的错误提示
            }
        }

        // --- Modal Control Functions (New/Detail/Edit) ---
        function openTradeModal() {
            // Set current date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('trade-date').value = today;
            tradeForm.reset();
            tradeModal.classList.remove('hidden');
        }

        function closeTradeModal() {
            tradeModal.classList.add('hidden');
        }

        function openEditModal(tradeData) {
            let trade;
            if (typeof tradeData === 'string') {
                try {
                    trade = JSON.parse(tradeData);
                } catch(e) {
                    console.error("Failed to parse trade JSON string for edit:", tradeData, e);
                    return;
                }
            } else {
                trade = tradeData;
            }

            // 填充编辑模态框
            document.getElementById('edit-trade-id').value = trade.id;
            document.getElementById('edit-symbol').value = trade.symbol;
            document.getElementById('edit-trade-date').value = trade.date;
            document.getElementById('edit-side').value = trade.side;
            // 确保 R 值和 PnL 是数字类型并保留两位小数
            document.getElementById('edit-r-multiple').value = parseFloat(trade.rMultiple).toFixed(2);
            document.getElementById('edit-pnl-amount').value = parseFloat(trade.pnlAmount).toFixed(2);
            document.getElementById('edit-model-tag').value = trade.modelTag || '';
            document.getElementById('edit-chart-link').value = trade.chartLink || '';
            document.getElementById('edit-notes').value = trade.notes || '';
            
            closeDetailModal(); // 关闭详情视图
            editModal.classList.remove('hidden');
        }

        function closeEditModal() {
            editModal.classList.add('hidden');
        }

        function openDetailModal(tradeData) {
            let trade;
            // Check if input is a string (came from HTML attribute, browser unescaped)
            if (typeof tradeData === 'string') {
                try {
                    trade = JSON.parse(tradeData);
                } catch(e) {
                    console.error("Failed to parse trade JSON string in openDetailModal:", tradeData, e);
                    return;
                }
            } else {
                // It's already the trade object (came from JS event handler: tradeRow.onclick)
                trade = tradeData;
            }

            const content = document.getElementById('detail-content');
            
            const pnlColor = trade.pnlAmount >= 0 ? 'text-emerald-400' : 'text-pink-500';
            const rColor = trade.rMultiple >= 0 ? 'text-emerald-400' : 'text-pink-500';
            const chartLinkHtml = trade.chartLink 
                ? `<p><strong><i class="fas fa-chart-area mr-2"></i> TradingView 图表:</strong> <a href="${trade.chartLink}" target="_blank" class="text-cyan-400 hover:underline">点击查看图表</a></p>`
                : `<p><strong><i class="fas fa-chart-area mr-2"></i> TradingView 图表:</strong> 未记录</p>`;

            content.innerHTML = `
                <div class="grid grid-cols-2 gap-4 border-b border-[#44447a] pb-4">
                    <p><strong><i class="fas fa-calendar-alt mr-2"></i> 日期:</strong> ${trade.date}</p>
                    <p><strong><i class="fas fa-coins mr-2"></i> 交易对:</strong> ${trade.symbol}</p>
                    <p><strong><i class="fas fa-exchange-alt mr-2"></i> 方向:</strong> <span class="${trade.side === 'LONG' ? 'text-emerald-400' : 'text-pink-500'}">${trade.side}</span></p>
                    <p><strong><i class="fas fa-tag mr-2"></i> 模型标签:</strong> ${trade.modelTag || 'N/A'}</p>
                </div>
                <div class="grid grid-cols-2 gap-4 border-b border-[#44447a] py-4">
                    <p><strong><i class="fas fa-money-bill-wave mr-2"></i> 绝对盈亏:</strong> <span class="text-lg font-bold ${pnlColor}">$${parseFloat(trade.pnlAmount).toFixed(2)}</span></p>
                    <p><strong><i class="fas fa-trophy mr-2"></i> R值:</strong> <span class="text-lg font-bold ${rColor}">${parseFloat(trade.rMultiple).toFixed(2)}R</span></p>
                </div>
                <div class="py-4 border-b border-[#44447a]">
                    ${chartLinkHtml}
                </div>
                <div class="pt-4">
                    <h4 class="text-lg font-semibold text-cyan-400 mb-2"><i class="fas fa-brain mr-2"></i> 交易心理与总结 (Journal)</h4>
                    <p class="component-bg p-3 rounded-lg border border-[#44447a] whitespace-pre-wrap">${trade.notes || '用户未记录总结。'}</p>
                </div>
            `;
            // 修改按钮区域，添加编辑按钮。使用 HTML 实体转义确保 JSON 字符串能安全嵌入 onclick 属性中。
            const tradeJsonForHtml = JSON.stringify(trade).replace(/"/g, '&quot;');
            document.querySelector('#detail-modal .flex.justify-end.pt-6').innerHTML = `
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="openEditModal('${tradeJsonForHtml}')" 
                            class="px-6 py-2 rounded-full border border-emerald-600 text-emerald-400 hover:bg-emerald-600/20 transition">
                        <i class="fas fa-edit mr-1"></i> 编辑
                    </button>
                    <button type="button" onclick="closeDetailModal()" class="px-6 py-2 rounded-full border border-gray-600 text-gray-300 hover:border-cyan-400 hover:text-cyan-400 transition">
                        关闭
                    </button>
                </div>
            `;
            detailModal.classList.remove('hidden');
        }
        
        function closeDetailModal() {
            detailModal.classList.add('hidden');
        }


        // --- Data Persistence (Firestore) ---
        async function saveTrade(e) {
            e.preventDefault();

            if (!isAuthReady) {
                console.error("Authentication not ready. Cannot save trade.");
                return;
            }

            const tradeData = {
                symbol: document.getElementById('symbol').value,
                date: document.getElementById('trade-date').value,
                side: document.getElementById('side').value,
                rMultiple: parseFloat(document.getElementById('r-multiple').value),
                pnlAmount: parseFloat(document.getElementById('pnl-amount').value),
                modelTag: document.getElementById('model-tag').value,
                chartLink: document.getElementById('chart-link').value,
                notes: document.getElementById('notes').value,
                timestamp: serverTimestamp(),
                userId: userId,
            };

            closeTradeModal(); // Immediately close modal
            logStatus.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i> 正在将交易数据存入矩阵...`;

            try {
                // Private collection path
                const tradesCollection = collection(db, 'artifacts', appId, 'users', userId, 'trade_logs');
                await addDoc(tradesCollection, tradeData);
                console.log("Trade saved successfully.");
                tradeForm.reset();
            } catch (error) {
                console.error("Error saving trade:", error);
                // Simple error display instead of alert
                logStatus.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i> 保存失败: ${error.message}`;
            }
        }
        
        // New: Update Trade Function
        async function updateTrade(e) {
            e.preventDefault();

            if (!isAuthReady) {
                console.error("Authentication not ready. Cannot update trade.");
                return;
            }

            const tradeId = document.getElementById('edit-trade-id').value;
            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'trade_logs', tradeId);

            const updatedData = {
                symbol: document.getElementById('edit-symbol').value,
                date: document.getElementById('edit-trade-date').value,
                side: document.getElementById('edit-side').value,
                rMultiple: parseFloat(document.getElementById('edit-r-multiple').value),
                pnlAmount: parseFloat(document.getElementById('edit-pnl-amount').value),
                modelTag: document.getElementById('edit-model-tag').value,
                chartLink: document.getElementById('edit-chart-link').value,
                notes: document.getElementById('edit-notes').value,
            };

            closeEditModal(); // Immediately close modal
            logStatus.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i> 正在更新交易数据...`;

            try {
                await updateDoc(docRef, updatedData);
                console.log("Trade updated successfully:", tradeId);
            } catch (error) {
                console.error("Error updating trade:", error);
                logStatus.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i> 更新失败: ${error.message}`;
            }
        }


        function loadTrades() {
            if (!isAuthReady) return;

            const tradesCollection = collection(db, 'artifacts', appId, 'users', userId, 'trade_logs');
            const q = query(tradesCollection);

            // Listen for real-time updates
            onSnapshot(q, (snapshot) => {
                const fetchedTrades = [];
                snapshot.forEach((doc) => {
                    fetchedTrades.push({ id: doc.id, ...doc.data() });
                });
                
                trades = fetchedTrades;
                
                // 1. 更新图表和指标（使用全部数据）
                updateChartAndMetrics(trades); 
                // 2. 生成日志筛选器选项（使用全部数据）
                generateLogFilterOptions(trades);
                // 3. 更新交易日志列表（应用当前筛选）
                applyLogFilter(currentLogFilter);

            }, (error) => {
                console.error("Error fetching trades:", error);
                logStatus.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i> 载入数据失败: ${error.message}`;
            });
        }
        
        // --- Trade Log Filter Logic ---
        
        function generateLogFilterOptions(trades) {
            const filterSelect = document.getElementById('month-year-filter');
            filterSelect.innerHTML = '<option value="all">显示全部记录</option>';
            
            const uniqueMonths = new Set();
            trades.forEach(trade => {
                if (trade.date) {
                    const yearMonth = trade.date.substring(0, 7); 
                    uniqueMonths.add(yearMonth);
                }
            });

            // 按时间倒序排序 (最新月份在前)
            const sortedMonths = Array.from(uniqueMonths).sort().reverse(); 

            sortedMonths.forEach(yearMonth => {
                const year = yearMonth.substring(0, 4);
                const month = yearMonth.substring(5, 7);
                const option = document.createElement('option');
                option.value = yearMonth;
                option.textContent = `${year}年${month}月`;
                filterSelect.appendChild(option);
            });

            // 恢复/设置选中的筛选值
            filterSelect.value = currentLogFilter;
        }

        function applyLogFilter(filterValue) {
            currentLogFilter = filterValue;
            
            let filteredTrades = trades;
            
            if (filterValue !== 'all') {
                // 筛选出日期以 'YYYY-MM' 开头的交易
                filteredTrades = trades.filter(trade => trade.date && trade.date.startsWith(filterValue));
            }
            
            // 按时间倒序排序 (最新交易在前)
            const logTrades = [...filteredTrades].sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
            updateTradeLogUI(logTrades);
        }

        // --- Equity Curve Charting Logic ---

        function calculateEquityCurve(trades) {
            // 确保交易数据按日期/时间戳升序排列
            const sortedTrades = [...trades].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

            let currentEquity = INITIAL_CAPITAL;
            const equityData = [];

            // 1. 添加初始资金点
            if (sortedTrades.length > 0) {
                // 使用第一笔交易的日期作为初始点
                equityData.push({
                    date: new Date(sortedTrades[0].date).toISOString().split('T')[0],
                    equity: INITIAL_CAPITAL
                });
            } else {
                // 如果没有交易，使用今天日期显示初始资金
                equityData.push({ 
                    date: new Date().toISOString().split('T')[0], 
                    equity: INITIAL_CAPITAL 
                });
            }

            // 2. 计算累积资产净值
            sortedTrades.forEach(trade => {
                currentEquity += trade.pnlAmount;
                equityData.push({
                    date: trade.date,
                    equity: currentEquity
                });
            });
            
            return equityData;
        }

        function filterEquityData(equityCurve, filterType) {
            // ... (Chart filtering logic remains the same, using the global INITIAL_CAPITAL)
            const today = new Date();
            let startDate = new Date(0); // Epoch - Default for 'all'

            const year = today.getFullYear();
            const month = today.getMonth(); // 0-11
            const dayOfWeek = today.getDay(); // 0=Sunday, 6=Saturday

            switch (filterType) {
                case 'year':
                    startDate = new Date(year, 0, 1); // 今年1月1日
                    break;
                case 'month':
                    startDate = new Date(year, month, 1); // 本月1日
                    break;
                case 'week':
                    // 计算本周一的日期
                    const firstDayOfWeek = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
                    startDate = new Date(today.getFullYear(), today.getMonth(), firstDayOfWeek);
                    startDate.setHours(0, 0, 0, 0);
                    break;
                case 'all':
                default:
                    return equityCurve; 
            }
            
            let filteredData = equityCurve.filter(data => new Date(data.date).getTime() >= startDate.getTime());
            
            // 如果过滤后的数据不包含初始点，则在开始处添加初始资本点
            if (filteredData.length > 0 && new Date(filteredData[0].date).getTime() > startDate.getTime()) {
                filteredData.unshift({
                    date: new Date(startDate).toISOString().split('T')[0],
                    equity: INITIAL_CAPITAL
                });
            } else if (filteredData.length === 0) {
                 // 如果该周期内没有交易，则只显示当前日期的初始资本
                filteredData.push({ date: today.toISOString().split('T')[0], equity: INITIAL_CAPITAL });
            }
            
            return filteredData;
        }


        function renderEquityChart(equityData) {
            // ... (Chart rendering logic remains the same)
            const labels = equityData.map(d => d.date);
            const dataPoints = equityData.map(d => d.equity);
            
            const ctx = document.getElementById('equity-chart').getContext('2d');

            if (equityChartInstance) {
                // Update existing chart instance
                equityChartInstance.data.labels = labels;
                equityChartInstance.data.datasets[0].data = dataPoints;
                equityChartInstance.update();
                return;
            }
            
            // Initialize new chart instance
            equityChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '账户资产净值 ($)',
                        data: dataPoints,
                        borderColor: '#00d4ff', // Cyan color
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        fill: true,
                        tension: 0.3, // Curve smoothing
                        pointRadius: 4,
                        pointBackgroundColor: '#8338ec',
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day', // 默认单位
                                displayFormats: {
                                    day: 'MM-dd',
                                    week: 'yyyy-MM',
                                    month: 'yyyy-MM',
                                    year: 'yyyy'
                                }
                            },
                            ticks: {
                                color: '#94a3b8',
                                autoSkip: true,
                                maxTicksLimit: 10
                            },
                            grid: {
                                color: '#2d2d4c',
                                drawBorder: false
                            }
                        },
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '资产净值 ($)',
                                color: '#e2e8f0'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: '#2d2d4c',
                                drawBorder: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false,
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `日期: ${context[0].label}`;
                                },
                                label: function(context) {
                                    return `资产净值: $${context.parsed.y.toFixed(2)}`;
                                }
                            },
                            backgroundColor: '#1a1a2e',
                            titleColor: '#00d4ff',
                            bodyColor: '#e2e8f0',
                            borderColor: '#00d4ff',
                            borderWidth: 1
                        }
                    }
                }
            });
        }

        function updateChartAndMetrics(allTrades) {
            // 1. Calculate the full equity curve (always based on all trades)
            const fullEquityCurve = calculateEquityCurve(allTrades);

            // 2. Determine current filter and filter data for the chart
            const activeFilterButton = document.querySelector('#time-filters .filter-button.bg-cyan-600\\/70');
            const activeFilter = activeFilterButton ? activeFilterButton.dataset.filter : 'all';
            const filteredEquityData = filterEquityData(fullEquityCurve, activeFilter);

            // 3. Render the chart
            renderEquityChart(filteredEquityData);
            
            // 4. Update metrics (always use ALL trades for the main dashboard metrics)
            calculateAndDisplayMetrics(allTrades); 
        }

        function setupChartFilters() {
            const filterButtons = document.querySelectorAll('#time-filters .filter-button');
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all
                    filterButtons.forEach(btn => {
                        btn.classList.remove('bg-cyan-600/70', 'text-white', 'font-semibold', 'shadow-md');
                        btn.classList.add('bg-[#252542]', 'text-gray-300');
                    });

                    // Add active class to clicked button
                    this.classList.add('bg-cyan-600/70', 'text-white', 'font-semibold', 'shadow-md');
                    this.classList.remove('bg-[#252542]', 'text-gray-300');
                    
                    // Re-render chart with new filter
                    updateChartAndMetrics(trades);
                });
            });
        }
        
        // --- UI Rendering ---
        function updateTradeLogUI(sortedTrades) {
            tradeLogBody.innerHTML = '';
            tradeCountSpan.textContent = sortedTrades.length;

            if (sortedTrades.length === 0) {
                tradeLogBody.innerHTML = `
                    <tr><td colspan="6" class="p-6 text-center text-gray-500 italic">
                        <i class="fas fa-box-open mr-2"></i> 当前筛选条件下没有交易记录。
                    </td></tr>
                `;
                return;
            }

            sortedTrades.forEach(trade => {
                const pnlColor = trade.pnlAmount >= 0 ? 'text-emerald-400' : 'text-pink-500';
                const rColor = trade.rMultiple >= 0 ? 'text-emerald-400' : 'text-pink-500';
                const sideIcon = trade.side === 'LONG' ? 'fa-chevron-up' : 'fa-chevron-down';
                
                const tradeRow = document.createElement('tr');
                tradeRow.className = 'hover:bg-[#1f1f3a] transition cursor-pointer';
                
                // 【修复点 1】：为 HTML 属性转义 JSON 字符串 (必须转义引号)
                const tradeJsonForHtml = JSON.stringify(trade).replace(/"/g, '&quot;'); 

                tradeRow.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${trade.date || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${trade.symbol || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap ${pnlColor}">${trade.side} <i class="fas ${sideIcon} text-xs ml-1"></i></td>
                    <td class="px-6 py-4 whitespace-nowrap ${rColor} font-medium">${parseFloat(trade.rMultiple).toFixed(2)}R</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right ${pnlColor} font-semibold">$${parseFloat(trade.pnlAmount).toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <!-- 按钮使用转义后的 JSON 字符串 -->
                        <button onclick="event.stopPropagation(); openDetailModal('${tradeJsonForHtml}')" 
                                class="text-cyan-400 hover:text-cyan-300 transition">
                            <i class="fas fa-search-plus mr-1"></i> 查看日志
                        </button>
                    </td>
                `;
                // 【修复点 2】：行点击事件直接传递原始对象，避免 JSON.parse 错误
                tradeRow.onclick = () => openDetailModal(trade);
                tradeLogBody.appendChild(tradeRow);
            });
        }

        // --- Metrics Calculation (TradeZella Analysis) ---
        function calculateAndDisplayMetrics(trades) {
            if (trades.length === 0) {
                metricsContainer.innerHTML = '';
                return;
            }

            const totalTrades = trades.length;
            const winningTrades = trades.filter(t => t.pnlAmount > 0);
            const losingTrades = trades.filter(t => t.pnlAmount < 0);
            
            const totalPnL = trades.reduce((sum, t) => sum + t.pnlAmount, 0);
            const returnPercent = (totalPnL / INITIAL_CAPITAL) * 100; 

            const winRate = totalTrades > 0 ? (winningTrades.length / totalTrades) * 100 : 0;
            const avgWin = winningTrades.length > 0 ? winningTrades.reduce((sum, t) => sum + t.pnlAmount, 0) / winningTrades.length : 0;
            const avgLoss = losingTrades.length > 0 ? losingTrades.reduce((sum, t) => sum + t.pnlAmount, 0) / losingTrades.length : 0;

            const expectancy = totalTrades > 0 ? totalPnL / totalTrades : 0;

            let maxDrawdown = 0;
            let currentEquity = INITIAL_CAPITAL;
            let peakEquity = INITIAL_CAPITAL;
            // Recalculate Drawdown using the sorted trades
            const sortedTradesByDate = [...trades].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
            sortedTradesByDate.forEach(t => {
                currentEquity += t.pnlAmount;
                if (currentEquity > peakEquity) {
                    peakEquity = currentEquity;
                }
                const drawdown = peakEquity > 0 ? (peakEquity - currentEquity) / peakEquity : 0;
                if (drawdown > maxDrawdown) {
                    maxDrawdown = drawdown;
                }
            });
            maxDrawdown = maxDrawdown * 100;

            const metricsData = [
                { label: '总回报率', value: `${totalPnL >= 0 ? '+' : ''}${returnPercent.toFixed(1)}%`, color: 'emerald-400', icon: 'fa-chart-line', borderClass: 'metric-profit' },
                { label: '总盈亏 ($)', value: `${totalPnL >= 0 ? '+' : ''}$${totalPnL.toFixed(2)}`, color: 'emerald-400', icon: 'fa-dollar-sign', borderClass: 'metric-profit' },
                { label: '最大回撤 (MDD)', value: `${maxDrawdown.toFixed(1)}%`, color: 'pink-500', icon: 'fa-arrow-down', borderClass: 'metric-drawdown' },
                { label: '胜率 (Win Rate)', value: `${winRate.toFixed(1)}%`, color: 'cyan-400', icon: 'fa-thumbs-up', borderClass: 'metric-neutral' },
                { label: '期望收益 ($/Trade)', value: `${expectancy >= 0 ? '+' : ''}$${expectancy.toFixed(2)}`, color: 'yellow-400', icon: 'fa-star', borderClass: 'metric-neutral' },
                { label: '平均盈利', value: `$${avgWin.toFixed(2)}`, color: 'emerald-400', icon: 'fa-arrow-up', borderClass: 'metric-profit' },
            ];

            metricsContainer.innerHTML = metricsData.map(m => `
                <div class="p-3 rounded-xl component-bg text-center shadow-lg ${m.borderClass}">
                    <i class="fas ${m.icon} text-xl text-${m.color} mb-1"></i>
                    <div class="text-xs uppercase text-gray-400">${m.label}</div>
                    <div class="text-xl font-bold text-${m.color}">${m.value}</div>
                </div>
            `).join('');
        }


        // --- Event Listeners and Initial Load ---
        window.onload = () => {
             // Set today's date for trade entry default
             const today = new Date().toISOString().split('T')[0];
             document.getElementById('trade-date').value = today;
             
             tradeForm.addEventListener('submit', saveTrade);
             editForm.addEventListener('submit', updateTrade); // New: Listener for edit form
             
             setupChartFilters(); // Setup chart filtering logic
             firebaseInit();
        };

        // Expose functions globally for HTML calls
        window.openTradeModal = openTradeModal;
        window.closeTradeModal = closeTradeModal;
        window.openDetailModal = openDetailModal;
        window.closeDetailModal = closeDetailModal;
        window.openEditModal = openEditModal; // New
        window.closeEditModal = closeEditModal; // New
        window.saveInitialCapital = saveInitialCapital; // New
        window.applyLogFilter = applyLogFilter; // New
        
    </script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

<script>
  // 1. 粘贴你从 Firebase 复制的配置信息
 const firebaseConfig = {
  apiKey: "AIzaSyDhzGgJ-Jjb6Ouztk2aV3WvPHimEJ1wagU",
  authDomain: "jinmu-c0549.firebaseapp.com",
  projectId: "jinmu-c0549",
  storageBucket: "jinmu-c0549.firebasestorage.app",
  messagingSenderId: "433198268542",
  appId: "1:433198268542:web:e3a1bb8aedd22c4db8982f",
  measurementId: "G-YHBMGP6C6X"
};

  // 2. 初始化 Firebase
  firebase.initializeApp(firebaseConfig);

  // 3. 引用 Firestore 数据库服务
  const db = firebase.firestore();

  // 4. 定义一个简单的保存数据的函数
  function saveTestData(inputData) {
      db.collection("messages").add({
          content: inputData,
          timestamp: firebase.firestore.FieldValue.serverTimestamp() // 记录写入时间
      })
      .then((docRef) => {
          console.log("数据写入成功，文档 ID: ", docRef.id);
          alert("数据已成功存储到 Firebase！请查看控制台。");
      })
      .catch((error) => {
          console.error("写入数据时发生错误: ", error);
          alert("数据存储失败，请检查浏览器控制台和 Firebase 规则。");
      });
  }

  // 5. 示例：在页面加载后自动尝试写入一条数据
  // 实际项目中你会把它绑定到按钮点击事件上
  // saveTestData("网站首次自动测试写入数据"); 
<input type="text" id="dataInput" placeholder="输入要存储的数据">
<button onclick="saveTestData(document.getElementById('dataInput').value)">存储数据</button>
</script>

</body>
</html>

