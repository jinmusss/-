<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JINMU PRO ULTIMATE - 目标矩阵</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Great+Vibes&display=swap');
        
        :root {
            /* Default Theme (Purple) */
            --primary: #d946ef;
            --primary-rgb: 217, 70, 239;
            --secondary: #a855f7;
            --secondary-rgb: 168, 85, 247;
            --accent: #f0abfc;
        }

        /* Dynamic Theme Utilities */
        .text-theme-primary { color: var(--primary) !important; }
        .bg-theme-primary { background-color: var(--primary) !important; }
        .bg-theme-primary-10 { background-color: rgba(var(--primary-rgb), 0.1) !important; }
        .bg-theme-primary-5 { background-color: rgba(var(--primary-rgb), 0.05) !important; }
        .bg-theme-primary-20 { background-color: rgba(var(--primary-rgb), 0.2) !important; }
        .text-gradient-theme {
            background-image: linear-gradient(to right, var(--accent), var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .border-theme-primary { border-color: var(--primary) !important; }
        .border-theme-primary-20 { border-color: rgba(var(--primary-rgb), 0.2) !important; }
        .border-theme-primary-50 { border-color: rgba(var(--primary-rgb), 0.5) !important; }
        .shadow-theme-primary { box-shadow: 0 4px 14px 0 rgba(var(--primary-rgb), 0.39) !important; }
        .shadow-theme-primary-sm { box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.2) !important; }
        .shadow-theme-primary-lg { box-shadow: 0 0 100px -20px rgba(var(--primary-rgb), 0.3) !important; }
        .drop-shadow-theme-primary { filter: drop-shadow(0 0 8px rgba(var(--primary-rgb), 0.8)); }
        .hover\:text-theme-primary:hover { color: var(--primary) !important; }
        .hover\:bg-theme-primary:hover { background-color: var(--primary) !important; }
        .hover\:bg-theme-primary-20:hover { background-color: rgba(var(--primary-rgb), 0.2) !important; }
        .hover\:border-theme-primary-50:hover { border-color: rgba(var(--primary-rgb), 0.5) !important; }
        .focus\:border-theme-primary:focus { border-color: var(--primary) !important; }
        .focus-within\:border-theme-primary:focus-within { border-color: var(--primary) !important; }
        .group:hover .group-hover\:text-theme-primary { color: var(--primary) !important; }
        .selection\:bg-theme-primary::selection { background-color: var(--primary) !important; color: black !important; }

        /* Flatpickr Customization */
        .flatpickr-calendar {
            background: rgba(17, 17, 34, 0.95) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: 0 0 30px rgba(0,0,0,0.5) !important;
            font-family: 'Inter', sans-serif !important;
            border-radius: 1rem !important;
        }
        .flatpickr-months .flatpickr-month {
            background: transparent !important;
            color: #fff !important;
            fill: #fff !important;
        }
        .flatpickr-current-month .flatpickr-monthDropdown-months {
            background: transparent !important;
            color: #fff !important;
            font-weight: 700 !important;
        }
        .flatpickr-current-month input.cur-year {
            color: #fff !important;
            font-weight: 700 !important;
        }
        .flatpickr-day {
            color: #9ca3af !important;
            border-radius: 8px !important;
            border: 1px solid transparent !important;
        }
        .flatpickr-day:hover {
            background: rgba(255,255,255,0.05) !important;
            border-color: rgba(255,255,255,0.1) !important;
            color: #fff !important;
        }
        .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange, .flatpickr-day.selected.inRange, .flatpickr-day.startRange.inRange, .flatpickr-day.endRange.inRange, .flatpickr-day.selected:focus, .flatpickr-day.startRange:focus, .flatpickr-day.endRange:focus, .flatpickr-day.selected:hover, .flatpickr-day.startRange:hover, .flatpickr-day.endRange:hover, .flatpickr-day.selected.prevMonthDay, .flatpickr-day.startRange.prevMonthDay, .flatpickr-day.endRange.prevMonthDay, .flatpickr-day.selected.nextMonthDay, .flatpickr-day.startRange.nextMonthDay, .flatpickr-day.endRange.nextMonthDay {
            background: var(--primary) !important;
            border-color: var(--primary) !important;
            color: #000 !important;
            font-weight: 900 !important;
            box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.4) !important;
        }
        .flatpickr-day.today {
            border-color: var(--primary) !important;
            color: var(--primary) !important;
        }
        .flatpickr-day.today:hover {
            background: var(--primary) !important;
            color: #000 !important;
        }
        .flatpickr-time {
            border-top: 1px solid rgba(255,255,255,0.08) !important;
        }
        .flatpickr-time .flatpickr-time-separator, .flatpickr-time .flatpickr-am-pm {
            color: #fff !important;
        }
        .flatpickr-time input {
            color: #fff !important;
        }
        span.flatpickr-weekday {
            background: transparent !important;
            color: #64748b !important;
            font-weight: 900 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.1em !important;
        }

        
        body {
            font-family: 'Inter', sans-serif;
            /* background-image: url("images/bj.jpg"); */
            /* background-size: cover; */
            /* background-position: center; */
            /* background-attachment: fixed; */
            /* background-repeat: no-repeat; */
            background-color: #000;
            color: #fff;
            min-height: 100vh;
        }

        #bg-video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            background-size: cover;
            object-fit: cover;
        }

        #video-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(5, 5, 10, 0.75);
        z-index: -99;
        backdrop-filter: blur(3px);
        opacity: 0;
        transition: opacity 0.8s ease-in-out;
    }

        /* 磨砂玻璃效果增强 */
        .component-bg { 
            background-color: rgba(20, 20, 35, 0.7); 
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* Custom Scrollbar for Dropdowns */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }

        /* Fixed Footer Style */
        .fixed-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(17, 17, 34, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            padding: 0.5rem 1.5rem;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem;
            color: #64748b;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Nav & Tab Styles */
        .nav-link {
            position: relative;
            color: #9ca3af;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.3s;
            cursor: pointer;
            padding: 0.5rem 1rem;
        }
        .nav-link:hover, .nav-link.active { color: #fff; }
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -4px; left: 0; width: 100%; height: 2px;
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }

        .view-section { display: none; animation: fadeIn 0.4s ease-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Table Optimization */
        th, td { vertical-align: middle; white-space: nowrap; }

        .input-dark { background-color: rgba(5, 5, 10, 0.8) !important; border: 1px solid #3d3d5c !important; color: white !important; font-size: 14px !important; }
        .hidden-view { display: none !important; }
        
        /* 进度条动画 */
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring__circle { transition: stroke-dashoffset 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); transform-origin: 50% 50%; }

        /* 日历强化 */
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; height: 100%; align-content: start; padding: 4px; }
.calendar-day { aspect-ratio: 1/1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 6px; font-size: 10px; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; min-height: 0; }
.calendar-day:hover { transform: scale(1.1); z-index: 10; box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.3); }
        .day-profit { background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.5); color: #10b981; }
        .day-loss { background: rgba(244, 63, 94, 0.2); border: 1px solid rgba(244, 63, 94, 0.5); color: #f43f5e; }
        .day-empty { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); color: #64748b; }
        
        /* 指标卡片 */
        .metric-card { border-top: 2px solid transparent; }
        /* .metric-card:hover { border-top-color: var(--primary); background: rgba(22, 22, 50, 0.9); transform: translateY(-5px); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); } */

        .cyber-button { background-image: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; border: none; box-shadow: 0 4px 15px rgba(var(--secondary-rgb), 0.3); }
        .cyber-button:hover { box-shadow: 0 0 25px rgba(var(--primary-rgb), 0.6); transform: scale(1.02); letter-spacing: 1px; }

        /* 强化日志行动画 */
        .trade-row { transition: all 0.2s ease-in-out; position: relative; }
        .trade-row:hover { 
            background: linear-gradient(90deg, rgba(var(--primary-rgb), 0.15) 0%, rgba(var(--primary-rgb), 0.05) 100%); 
            box-shadow: inset 2px 0 0 0 var(--primary), 0 0 20px rgba(var(--primary-rgb), 0.1);
            z-index: 5;
        }
        .trade-row:hover .text-gray-400 { color: var(--accent) !important; text-shadow: 0 0 8px rgba(var(--primary-rgb), 0.4); }
        
        .action-icon { transition: all 0.2s ease-out; width: 42px; height: 42px; border-radius: 12px; background: rgba(255,255,255,0.03); font-size: 1.1rem; }
        .action-icon:hover { background: rgba(var(--primary-rgb), 0.2); color: var(--primary); box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.4); }

        /* 弹窗弹出动画 */
        @keyframes modalIn {
            0% { opacity: 0; transform: scale(0.8) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        .modal-animate { animation: modalIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #3d3d5c; border-radius: 10px; }

        /* 行情监控特定样式 */
        .price-up { color: #10b981; animation: flash-green 0.6s ease-out; }
        .price-down { color: #ef4444; animation: flash-red 0.6s ease-out; }

        @keyframes flash-green { 0% { background-color: rgba(16, 185, 129, 0.15); } 100% { background-color: transparent; } }
        @keyframes flash-red { 0% { background-color: rgba(239, 68, 68, 0.15); } 100% { background-color: transparent; } }
        
        .crypto-icon { font-size: 1.5rem; opacity: 0.8; }
        
        /* New Script Font & Glow Styles */
        .font-script { font-family: 'Great Vibes', cursive; }
        .font-display { font-family: 'Impact', 'Arial Black', sans-serif; letter-spacing: 0.05em; }
        
        .glow-flow-text {
            color: #fff;
            text-shadow: 0 0 10px rgba(var(--primary-rgb), 0.5), 0 0 20px rgba(var(--primary-rgb), 0.3);
            animation: glow-breathe 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow-breathe {
            from {
                text-shadow: 0 0 5px rgba(255, 255, 255, 0.5), 0 0 10px rgba(var(--primary-rgb), 0.5), 0 0 20px rgba(var(--secondary-rgb), 0.3);
            }
            to {
                text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(var(--primary-rgb), 0.8), 0 0 30px rgba(var(--primary-rgb), 0.6), 0 0 40px rgba(var(--secondary-rgb), 0.5);
            }
        }
        
        /* Rotating Border Glow for Login Box */
        .login-box-glow {
            position: relative;
            z-index: 0;
            overflow: hidden;
            border-radius: 1.5rem;
            padding: 3px !important; /* Make space for the border */
            background: transparent !important;
            box-shadow: 0 0 40px rgba(var(--primary-rgb), 0.2);
        }
        
        .login-box-glow::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, var(--secondary), var(--primary), #fff, var(--primary), var(--secondary), transparent 40%);
            animation: rotate-border 3s linear infinite;
            z-index: -2;
        }
        
        .login-box-glow::after {
            content: '';
            position: absolute;
            inset: 3px;
            background: rgba(17, 17, 34, 0.9);
            backdrop-filter: blur(20px);
            border-radius: calc(1.5rem - 3px);
            z-index: -1;
        }
        
        .login-box-content {
            position: relative;
            z-index: 1;
            padding: 2.5rem; /* p-10 equivalent */
            height: 100%;
            border-radius: 1.5rem;
        }
        
        @keyframes rotate-border {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* -----------------------------------
           New Advanced Text Animations
           ----------------------------------- */
        @keyframes shine-flow-horizontal {
            0% { background-position: 200% center; }
            100% { background-position: -200% center; }
        }
        
        .text-liquid-gold {
            background: linear-gradient(
                90deg, 
                var(--primary) 0%, 
                #ffffff 25%, 
                var(--primary) 50%, 
                #ffffff 75%, 
                var(--primary) 100%
            );
            background-size: 200% auto;
            color: transparent;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine-flow-horizontal 4s linear infinite;
            filter: drop-shadow(0 0 15px rgba(var(--primary-rgb), 0.6));
        }

        .line-scanner {
            position: relative;
            overflow: hidden;
        }
        .line-scanner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            transform: translateX(-100%);
            animation: scan-move 3s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }
        @keyframes scan-move {
            0% { transform: translateX(-100%); }
            50%, 100% { transform: translateX(100%); }
        }

        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }
        .group-hover\:animate-shimmer:hover {
            animation: shimmer 0.8s ease-in-out;
        }

        /* Jelly / Bounce Effect */
        @keyframes jelly {
            0%, 100% { transform: scale(1, 1); }
            25% { transform: scale(0.9, 1.1); }
            50% { transform: scale(1.1, 0.9); }
            75% { transform: scale(0.95, 1.05); }
        }
        .hover\:animate-jelly:hover {
            animation: jelly 0.5s both;
        }
    </style>

</head>
<body class="selection:bg-theme-primary selection:text-black">
    <video autoplay muted loop playsinline id="bg-video">
        <source src="bg.mp4" type="video/mp4">
    </video>
    <div id="video-overlay"></div>

    <!-- Auth View -->
    <div id="auth-view" class="min-h-screen relative overflow-hidden flex items-center justify-center p-8 hidden-view">
        <div class="absolute -top-24 -left-24 w-80 h-80 bg-theme-primary-5 blur-[100px]"></div>
        <div class="absolute -bottom-24 -right-10 w-96 h-96 bg-indigo-500/5 blur-[120px]"></div>
        <div class="relative w-full max-w-md login-box-glow animate__animated animate__fadeInUp">
            <div class="login-box-content">
<div class="text-center mb-10">
                    <h1 class="text-5xl font-script glow-flow-text tracking-wider">Jinmu Trade</h1>
                    <p class="mt-4 text-[10px] font-black tracking-[0.6em] text-gradient-theme uppercase animate-pulse drop-shadow-theme-primary">
                        Jinmu Always Win
                    </p>
                </div>
                <form id="auth-form" class="space-y-6">
                <div class="relative">
                    <i class="fas fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                    <input type="email" id="auth-email" required class="w-full pl-10 p-5 rounded-2xl input-dark" placeholder="邮箱账号">
                </div>
                <div class="relative">
                    <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                    <input type="password" id="auth-password" required class="w-full pl-10 p-5 rounded-2xl input-dark" placeholder="密码">
                </div>
                <button type="submit" class="cyber-button w-full py-5 rounded-2xl font-black uppercase tracking-widest text-lg hover:shadow-theme-primary">进入</button>
                <button type="button" id="btn-register" class="w-full text-gray-400 text-xs hover:text-theme-primary transition-colors">注册</button>
            </form>
            </div>
        </div>
    </div>

    <!-- Main View -->
    <div id="main-view" class="hidden-view p-4 md:p-6 max-w-[1800px] mx-auto w-full flex flex-col h-screen overflow-hidden">
        <!-- Top Navigation -->
        <header class="flex-none mb-4 flex justify-between items-center bg-[#111122]/90 backdrop-blur-md px-8 py-4 rounded-2xl border border-white/5 shadow-lg z-50">
            <div class="flex items-center space-x-8">
                <div class="flex items-center space-x-4">

                    <div>
                        <h1 class="text-2xl font-script glow-flow-text tracking-wide leading-none pt-1">Jinmu Trade</h1>
                    </div>
                </div>
                
                <nav class="hidden md:flex items-center space-x-6 ml-8">
                    <a onclick="switchView('dashboard')" id="nav-dashboard" class="nav-link active">Dashboard</a>
                    <a onclick="switchView('trades')" id="nav-trades" class="nav-link">Trades</a>
                    <a onclick="switchView('analytics')" id="nav-analytics" class="nav-link">Analytics</a>
                    <a onclick="switchView('learn')" id="nav-learn" class="nav-link">Learn</a>
                    <a onclick="switchView('settings')" id="nav-settings" class="nav-link">Settings</a>
                </nav>
            </div>

            <div class="flex items-center space-x-6">
                <button onclick="window.openModal()" class="relative overflow-hidden bg-theme-primary text-white px-4 py-2 rounded-lg text-xs font-bold transition-all shadow-lg shadow-theme-primary-sm flex items-center mr-2 group active:scale-95 hover:animate-jelly">
                    <div class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/30 to-transparent -translate-x-full group-hover:animate-shimmer"></div>
                    <i class="fas fa-plus mr-2 transition-transform duration-300 group-hover:rotate-90"></i> 
                    <span class="relative z-10">记一笔</span>
                </button>
                <div class="flex flex-col items-end">
                    <span id="user-display-name" class="text-xs font-bold text-gray-300 tracking-wide">OPERATOR</span>
                    <span class="flex items-center text-[10px] text-emerald-500 uppercase font-bold tracking-wider">
                        <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full mr-1.5 animate-pulse"></span> Online
                    </span>
                    <span id="last-sync-time" class="text-[9px] text-gray-500 font-mono mt-0.5 opacity-60">Waiting...</span>
                </div>
                <div class="h-8 w-[1px] bg-white/10"></div>
                <button id="btn-logout" class="text-gray-400 hover:text-rose-500 transition-colors">
                    <i class="fas fa-power-off text-lg"></i>
                </button>
            </div>
        </header>

        <!-- Secondary Toolbar Removed -->

        <!-- Scrollable Content Area -->
        <main class="flex-grow overflow-y-auto pr-2 space-y-8 scroll-smooth" id="content-container">
            
            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="view-section active h-full flex flex-col gap-0 overflow-y-auto">
                <!-- Crypto Ticker Moved to Stack -->

            <!-- 顶层：目标进度与设置 + 专业指标 -->
            <div class="grid grid-cols-1 xl:grid-cols-12 gap-6 shrink-0 h-auto min-h-[220px] mb-8 relative z-10">
                <!-- Account Growth Tracker -->
                <div class="xl:col-span-3 p-5 rounded-3xl component-bg border border-theme-primary-20 relative overflow-hidden shadow-2xl flex flex-col justify-between">
                    <div class="absolute -right-10 -top-10 w-40 h-40 bg-theme-primary-5 blur-3xl rounded-full"></div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs text-theme-primary font-black uppercase tracking-[0.25em]">Account Growth</span>
                        <i class="fas fa-radar text-gray-700"></i>
                    </div>
                    
                    <div class="flex flex-row items-center gap-6 h-full justify-center">
                        <div class="relative flex items-center justify-center shrink-0 group">
                            <div class="absolute inset-0 bg-theme-primary-10 blur-2xl rounded-full scale-0 group-hover:scale-110 transition-transform duration-700"></div>
                            <svg class="progress-ring relative" width="110" height="110">
                                <circle class="text-white/5" stroke-width="8" stroke="currentColor" fill="transparent" r="48" cx="55" cy="55"/>
                                <circle id="goal-progress-bar" class="text-theme-primary progress-ring__circle" stroke-width="8" stroke-dasharray="301.6" stroke-dashoffset="301.6" stroke-linecap="round" stroke="currentColor" fill="transparent" r="48" cx="55" cy="55"/>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <span id="goal-percent" class="text-xl font-black text-white tracking-tighter">0%</span>
                            </div>
                        </div>

                        <div class="flex flex-col justify-center space-y-2">
                            <div class="space-y-1">
                                <label class="text-[10px] text-gray-400 uppercase font-black tracking-widest">Target</label>
                                <div class="flex items-center relative overflow-visible group cursor-default">
                                    <span class="text-theme-primary font-black text-2xl mr-1 italic opacity-80">$</span>
                                    <span id="dashboard-target-display" class="font-display text-4xl italic text-liquid-gold py-0 leading-normal block select-none pr-2 hover:scale-105 transition-transform origin-left cursor-pointer">20,000</span>
                                </div>
                            </div>
                            <div class="pt-2 border-t border-white/5">
                                <p id="remaining-label" class="text-[10px] text-gray-400 italic font-medium tracking-tight">AI 正在解析...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Crypto Stack -->
                <div class="xl:col-span-2 flex flex-col gap-3 h-full">
                    <!-- BTC -->
                    <div id="btcusdt" class="flex-1 component-bg rounded-xl p-3 shadow-lg relative overflow-hidden flex flex-col justify-center border-l-4 border-transparent hover:border-l-[#F7931A] group">
                        <div class="flex justify-between items-center z-10 relative">
                            <div>
                                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">BTC</span>
                                <div id="btc-price" class="text-lg font-black tracking-tighter text-white transition-colors duration-300">0.00</div>
                            </div>
                            <div class="text-right">
                                <div id="btc-change" class="text-[10px] font-bold px-2 py-1 rounded bg-white/5">--%</div>
                            </div>
                        </div>
                        <i class="fa-brands fa-bitcoin absolute -right-6 -bottom-6 text-[6rem] text-[#F7931A] opacity-10 group-hover:opacity-20 transition-all group-hover:rotate-12 pointer-events-none"></i>
                    </div>

                    <!-- ETH -->
                    <div id="ethusdt" class="flex-1 component-bg rounded-xl p-3 shadow-lg relative overflow-hidden flex flex-col justify-center border-l-4 border-transparent hover:border-l-[#627EEA] group">
                        <div class="flex justify-between items-center z-10 relative">
                            <div>
                                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">ETH</span>
                                <div id="eth-price" class="text-lg font-black tracking-tighter text-white transition-colors duration-300">0.00</div>
                            </div>
                            <div class="text-right">
                                <div id="eth-change" class="text-[10px] font-bold px-2 py-1 rounded bg-white/5">--%</div>
                            </div>
                        </div>
                        <i class="fa-brands fa-ethereum absolute -right-6 -bottom-6 text-[6rem] text-[#627EEA] opacity-10 group-hover:opacity-20 transition-all group-hover:rotate-12 pointer-events-none"></i>
                    </div>

                    <!-- DOGE -->
                    <div id="dogeusdt" class="flex-1 component-bg rounded-xl p-3 shadow-lg relative overflow-hidden flex flex-col justify-center border-l-4 border-transparent hover:border-l-[#C2A633] group">
                        <div class="flex justify-between items-center z-10 relative">
                            <div>
                                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">DOGE</span>
                                <div id="doge-price" class="text-lg font-black tracking-tighter text-white transition-colors duration-300">0.00</div>
                            </div>
                            <div class="text-right">
                                <div id="doge-change" class="text-[10px] font-bold px-2 py-1 rounded bg-white/5">--%</div>
                            </div>
                        </div>
                        <i class="fa-solid fa-paw absolute -right-6 -bottom-6 text-[6rem] text-[#C2A633] opacity-10 group-hover:opacity-20 transition-all group-hover:rotate-12 pointer-events-none"></i>
                    </div>
                </div>

                <!-- Position Calculator -->
                <div class="xl:col-span-2 p-4 rounded-xl component-bg border border-theme-primary-20 shadow-lg flex flex-col justify-between">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs text-theme-primary font-black uppercase tracking-wider">仓位计算器</span>
                        <i class="fas fa-calculator text-gray-600"></i>
                    </div>
                    <div class="space-y-3 flex-grow flex flex-col justify-center">
                        <div class="flex items-center bg-black/40 px-3 py-3 rounded-xl border border-white/5">
                            <span class="text-theme-primary font-black mr-2 text-sm">$</span>
                            <input type="number" id="calc-risk-amount" class="bg-transparent border-none p-0 text-white font-black text-sm w-full focus:ring-0" placeholder="Risk $">
                        </div>
                        <div class="flex items-center bg-black/40 px-3 py-3 rounded-xl border border-white/5">
                            <i class="fas fa-percent text-theme-primary text-xs mr-2"></i>
                            <input type="number" id="calc-risk-percent" class="bg-transparent border-none p-0 text-white font-black text-sm w-full focus:ring-0" placeholder="Risk %" step="0.1">
                        </div>
                    </div>
                    <div class="flex justify-between items-center bg-white/5 rounded-xl px-3 py-3 mt-2">
                        <span class="text-[10px] text-gray-500 uppercase font-black">Size</span>
                        <span id="calc-result" class="text-xl font-black text-white">$0.00</span>
                    </div>
                </div>

                <!-- 指标网格 -->
                <div class="xl:col-span-5 grid grid-cols-2 md:grid-cols-4 gap-3" id="metrics-grid"></div>
            </div>

            <!-- 中间：日历与曲线 -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow min-h-0 relative z-0 mt-4 pb-4">
                <!-- Recent Trades (Mini) -->
                <div class="lg:col-span-4 xl:col-span-2 p-5 rounded-3xl component-bg border border-theme-primary-20 shadow-2xl flex flex-col overflow-hidden min-h-0 h-full">
                    <div class="flex items-center justify-between mb-4 shrink-0">
                        <span class="text-sm text-theme-primary font-black uppercase tracking-[0.25em]">Recent Trades</span>
                        <i class="fas fa-history text-gray-700"></i>
                    </div>
                    <div class="flex-grow overflow-y-auto custom-scrollbar pr-1">
                        <table class="w-full">
                            <tbody id="mini-trade-list" class="text-sm text-gray-400 font-bold">
                                <!-- Injected by JS -->
                            </tbody>
                        </table>
                        <div id="mini-empty-state" class="hidden text-center py-4 text-xs text-gray-600">No trades yet</div>
                    </div>
                </div>

                <div class="lg:col-span-4 xl:col-span-3 p-4 rounded-3xl component-bg border border-white/10 shadow-xl overflow-hidden flex flex-col min-h-0 h-full">
                    <div class="flex flex-col space-y-2 mb-2">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xs font-black text-white uppercase tracking-widest flex items-center"><i class="fas fa-calendar-alt mr-2 text-theme-primary"></i>交易日历</h3>
                            <button id="btn-current-month" class="px-2 py-1 text-[9px] bg-white/5 rounded-lg text-gray-400 hover:bg-theme-primary hover:text-black font-black transition-all">当前月</button>
                        </div>
                        <div class="flex space-x-2">
                            <input type="month" id="calendar-month-select" class="flex-grow bg-[#05050a] border border-[#2d2d4c] text-theme-primary text-[10px] px-2 py-1 rounded-lg outline-none font-black h-8">
                            <button onclick="window.changeMonth(-1)" class="w-8 h-8 bg-white/5 rounded-lg hover:text-theme-primary transition-colors flex items-center justify-center"><i class="fas fa-chevron-left text-xs"></i></button>
                            <button onclick="window.changeMonth(1)" class="w-8 h-8 bg-white/5 rounded-lg hover:text-theme-primary transition-colors flex items-center justify-center"><i class="fas fa-chevron-right text-xs"></i></button>
                        </div>
                    </div>
                    <div class="grid grid-cols-7 gap-1 text-[9px] text-gray-600 mb-1 text-center uppercase font-black tracking-widest">
                        <div>一</div><div>二</div><div>三</div><div>四</div><div>五</div><div>六</div><div>日</div>
                    </div>
                    <div id="calendar-heatmap" class="calendar-grid flex-grow content-start"></div>
                    <div class="mt-2 pt-2 border-t border-white/5 flex justify-between items-center">
                        <div>
                            <p class="text-[9px] text-gray-500 uppercase font-black tracking-widest mb-0.5">视图盈亏</p>
                            <p id="view-pnl" class="text-sm font-black font-mono">+$0.00</p>
                        </div>
                        <div class="text-center">
                            <p class="text-[9px] text-gray-500 uppercase font-black tracking-widest mb-0.5">本月收益率</p>
                            <p id="view-roi" class="text-sm font-black font-mono text-white">0.00%</p>
                        </div>
                        <div class="text-right">
                            <p class="text-[9px] text-gray-500 uppercase font-black tracking-widest mb-0.5">交易次数</p>
                            <p id="view-count" class="text-sm font-black font-mono text-white">0</p>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-8 xl:col-span-7 p-4 rounded-3xl component-bg shadow-2xl relative overflow-hidden flex flex-col h-full">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-theme-primary-5 blur-[100px] pointer-events-none"></div>
                    <div class="flex justify-between items-center mb-2 shrink-0">
                        <h3 class="text-xs font-black text-gray-400 uppercase tracking-[0.3em]"><i class="fas fa-wave-square mr-2 text-theme-primary"></i>Equity Curve Analytics</h3>
                        <div class="flex bg-black/40 rounded-lg p-1 border border-white/5">
                            <button id="chart-mode-view" class="px-2 py-0.5 text-[9px] font-black rounded-md text-gray-400 hover:text-white transition-all">VIEW</button>
                            <button id="chart-mode-all" class="px-2 py-0.5 text-[9px] font-black rounded-md bg-theme-primary text-black shadow-lg shadow-theme-primary-sm">ALL</button>
                        </div>
                    </div>
                    <div class="flex-grow w-full relative min-h-0"><canvas id="equity-chart"></canvas></div>
                </div>
            </div>

            </div> <!-- End Dashboard View -->

            <!-- VIEW: TRADES (Table) -->
            <div id="view-trades" class="view-section space-y-6">
                <div class="p-6 rounded-3xl component-bg border border-white/5 shadow-2xl">
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <div class="flex items-center space-x-4">
                            <h3 class="text-lg font-bold text-white flex items-center"><i class="fas fa-list-ul mr-3 text-theme-primary"></i> Trade Journal</h3>
                            
                            <!-- Year Picker -->
                            <div class="relative inline-block text-left" id="year-picker-container">
                                <button id="year-picker-btn" onclick="toggleYearPicker()" class="flex items-center px-4 py-2 rounded-xl bg-theme-primary-10 border border-theme-primary text-theme-primary font-black text-sm hover:bg-theme-primary hover:!text-black transition-all shadow-lg shadow-theme-primary-sm outline-none group">
                                    <i class="fas fa-calendar-alt mr-2 group-hover:text-black"></i>
                                    <span id="year-picker-label">YYYY</span>
                                    <i class="fas fa-chevron-down ml-2 text-[10px] group-hover:text-black"></i>
                                </button>
                                <input type="hidden" id="global-year">
                                <div id="year-picker-dropdown" class="hidden absolute left-0 top-full mt-2 w-24 rounded-xl component-bg border border-white/10 shadow-2xl z-[100] max-h-60 overflow-y-auto custom-scrollbar p-1"></div>
                            </div>

                            <!-- Month Picker -->
                            <div class="relative inline-block text-left" id="month-picker-container">
                                <button id="month-picker-btn" onclick="toggleMonthPicker()" class="flex items-center px-4 py-2 rounded-xl bg-theme-primary-10 border border-theme-primary text-theme-primary font-black text-sm hover:bg-theme-primary hover:!text-black transition-all shadow-lg shadow-theme-primary-sm outline-none group">
                                    <span id="month-picker-label">MM月</span>
                                    <i class="fas fa-chevron-down ml-2 text-[10px] group-hover:text-black"></i>
                                </button>
                                <input type="hidden" id="global-month">
                                <div id="month-picker-dropdown" class="hidden absolute left-0 top-full mt-2 w-24 rounded-xl component-bg border border-white/10 shadow-2xl z-[100] max-h-60 overflow-y-auto custom-scrollbar p-1"></div>
                            </div>
                        </div>

                        <div class="flex items-center space-x-2">
                             <button onclick="window.triggerImport()" class="bg-[#1a1a2e] hover:bg-[#252540] text-gray-300 px-3 py-1.5 rounded-lg text-xs font-bold border border-white/10 transition-all" title="Import CSV">
                                <i class="fas fa-file-import"></i>
                            </button>
                            <button onclick="window.exportToCSV()" class="bg-[#1a1a2e] hover:bg-[#252540] text-gray-300 px-3 py-1.5 rounded-lg text-xs font-bold border border-white/10 transition-all" title="Export CSV">
                                <i class="fas fa-file-export"></i>
                            </button>
                             <div class="h-6 w-[1px] bg-white/10 mx-1"></div>
                             <input type="text" id="table-search" placeholder="Search..." class="bg-black/30 border border-white/10 rounded-lg px-3 py-1.5 text-xs text-white focus:border-theme-primary outline-none w-40">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr class="text-left text-[10px] uppercase text-gray-500 font-bold tracking-wider border-b border-white/5">
                                    <th class="px-4 py-4 cursor-pointer hover:text-white">Date / 时间</th>
                                    <th class="px-4 py-4 cursor-pointer hover:text-white">Symbol / 交易对</th>
                                    <th class="px-4 py-4 text-center cursor-pointer hover:text-white">Side / 方向</th>
                                    <th class="px-4 py-4 text-right cursor-pointer hover:text-white">PnL / 盈亏 ($)</th>
                                    <th class="px-4 py-4 text-right">Action / 操作</th>
                                </tr>
                            </thead>
                            <tbody id="trade-list" class="divide-y divide-white/5 text-xs font-medium text-gray-300"></tbody>
                        </table>
                        <div id="empty-state" class="hidden py-20 text-center text-gray-600">
                            <i class="fas fa-inbox text-4xl mb-3"></i>
                            <p class="text-xs">No records found matching filters.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: ANALYTICS -->
            <div id="view-analytics" class="view-section space-y-6">
                <!-- Analytics Toolbar -->
                <div class="flex justify-between items-center mb-6 px-2">
                    <h3 class="text-xl font-black text-white uppercase tracking-widest flex items-center">
                        <i class="fas fa-chart-pie mr-3 text-theme-primary"></i> Performance Analytics
                    </h3>
                    
                    <!-- Analytics Year Picker -->
                    <div class="relative inline-block text-left" id="analytics-year-picker-container">
                        <button onclick="toggleAnalyticsYearPicker()" class="flex items-center px-4 py-2 rounded-xl bg-theme-primary-10 border border-theme-primary text-theme-primary font-black text-sm hover:bg-theme-primary hover:!text-black transition-all shadow-lg shadow-theme-primary-sm outline-none group">
                            <i class="fas fa-calendar-alt mr-2 group-hover:text-black"></i>
                            <span id="analytics-year-label">2025</span>
                            <i class="fas fa-chevron-down ml-2 text-[10px] group-hover:text-black"></i>
                        </button>
                        <div id="analytics-year-picker-dropdown" class="hidden absolute right-0 top-full mt-2 w-32 rounded-xl component-bg border border-white/10 shadow-2xl z-[100] max-h-60 overflow-y-auto custom-scrollbar p-1"></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Monthly PnL Chart -->
                    <div class="p-6 rounded-3xl component-bg border border-white/5 shadow-xl flex flex-col h-[400px]">
                        <h3 class="text-xs font-black text-gray-400 uppercase tracking-[0.2em] mb-4 flex items-center justify-between">
                            <span>Monthly PnL (盈亏)</span>
                            <i class="fas fa-chart-bar text-emerald-500"></i>
                        </h3>
                        <div class="flex-grow w-full relative">
                            <canvas id="analytics-pnl-chart"></canvas>
                        </div>
                    </div>

                    <!-- Monthly ROI Chart -->
                    <div class="p-6 rounded-3xl component-bg border border-white/5 shadow-xl flex flex-col h-[400px]">
                        <h3 class="text-xs font-black text-gray-400 uppercase tracking-[0.2em] mb-4 flex items-center justify-between">
                            <span>Monthly ROI (收益率)</span>
                            <i class="fas fa-percentage text-blue-500"></i>
                        </h3>
                        <div class="flex-grow w-full relative">
                            <canvas id="analytics-roi-chart"></canvas>
                        </div>
                    </div>

                    <!-- Monthly Win Rate Chart -->
                    <div class="p-6 rounded-3xl component-bg border border-white/5 shadow-xl flex flex-col h-[400px]">
                        <h3 class="text-xs font-black text-gray-400 uppercase tracking-[0.2em] mb-4 flex items-center justify-between">
                            <span>Monthly Win Rate (胜率)</span>
                            <i class="fas fa-trophy text-yellow-500"></i>
                        </h3>
                        <div class="flex-grow w-full relative">
                            <canvas id="analytics-wr-chart"></canvas>
                        </div>
                    </div>

                    <!-- Monthly Trade Count Chart -->
                    <div class="p-6 rounded-3xl component-bg border border-white/5 shadow-xl flex flex-col h-[400px]">
                        <h3 class="text-xs font-black text-gray-400 uppercase tracking-[0.2em] mb-4 flex items-center justify-between">
                            <span>Monthly Trades (交易数)</span>
                            <i class="fas fa-list-ol text-purple-500"></i>
                        </h3>
                        <div class="flex-grow w-full relative">
                            <canvas id="analytics-count-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: LEARN -->
            <div id="view-learn" class="view-section">
                <div class="p-8 rounded-3xl component-bg border border-white/5 shadow-2xl min-h-[600px]">
                    <div class="flex justify-between items-center mb-8">
                         <h3 class="text-lg font-bold text-white flex items-center"><i class="fab fa-youtube mr-3 text-red-500"></i> Learning Center</h3>
                    </div>
                    <div id="video-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <!-- Videos will be injected here -->
                    </div>
                </div>
            </div>

            <!-- VIEW: SETTINGS -->
            <div id="view-settings" class="view-section">
                <div class="p-8 rounded-3xl component-bg border border-white/5 shadow-2xl space-y-8">
                    
                    <!-- Theme Settings -->
                    <div>
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center"><i class="fas fa-palette mr-3 text-theme-primary"></i>Theme Color / 主题配色</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="window.setTheme('purple')" class="group relative p-4 rounded-xl border border-white/10 hover:border-fuchsia-500 transition-all bg-[#1a1a2e] flex flex-col items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-fuchsia-400 to-purple-600 shadow-lg group-hover:scale-110 transition-transform"></div>
                                <span class="text-xs font-bold text-gray-400 group-hover:text-white">Purple (Default)</span>
                            </button>
                            <button onclick="window.setTheme('blue')" class="group relative p-4 rounded-xl border border-white/10 hover:border-sky-500 transition-all bg-[#1a1a2e] flex flex-col items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-sky-400 to-blue-600 shadow-lg group-hover:scale-110 transition-transform"></div>
                                <span class="text-xs font-bold text-gray-400 group-hover:text-white">Ocean Blue</span>
                            </button>
                            <button onclick="window.setTheme('green')" class="group relative p-4 rounded-xl border border-white/10 hover:border-emerald-500 transition-all bg-[#1a1a2e] flex flex-col items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-400 to-green-600 shadow-lg group-hover:scale-110 transition-transform"></div>
                                <span class="text-xs font-bold text-gray-400 group-hover:text-white">Emerald Green</span>
                            </button>
                            <button onclick="window.setTheme('orange')" class="group relative p-4 rounded-xl border border-white/10 hover:border-orange-500 transition-all bg-[#1a1a2e] flex flex-col items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-orange-400 to-red-600 shadow-lg group-hover:scale-110 transition-transform"></div>
                                <span class="text-xs font-bold text-gray-400 group-hover:text-white">Sunset Orange</span>
                            </button>
                        </div>
                    </div>

                    <!-- Capital Settings (Moved from Dashboard) -->
                    <div class="pt-8 border-t border-white/5">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center"><i class="fas fa-wallet mr-3 text-theme-primary"></i>Account Configuration / 资金设置</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-3">
                                <label class="text-xs text-gray-400 uppercase font-bold tracking-wider">Initial Capital (初始资金)</label>
                                <div class="flex items-center bg-black/40 px-5 py-4 rounded-2xl border border-white/10 focus-within:border-theme-primary transition-all">
                                    <span class="text-theme-primary font-black mr-3 text-lg">$</span>
                                    <input type="number" id="initial-capital" class="bg-transparent border-none p-0 text-white font-black text-lg w-full focus:ring-0" value="10000">
                                </div>
                                <p class="text-[10px] text-gray-600">Starting balance for ROI calculations.</p>
                            </div>
                            <div class="space-y-3">
                                <label class="text-xs text-gray-400 uppercase font-bold tracking-wider">Target Capital (目标资金)</label>
                                <div class="flex items-center bg-black/40 px-5 py-4 rounded-2xl border border-white/10 focus-within:border-theme-primary transition-all">
                                    <span class="text-theme-primary font-black mr-3 text-lg">$</span>
                                    <input type="number" id="target-capital" class="bg-transparent border-none p-0 text-white font-black text-lg w-full focus:ring-0" value="20000">
                                </div>
                                <p class="text-[10px] text-gray-600">Goal amount for progress tracking.</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </main>
    </div>

    <!-- Trade Modal -->
    <div id="trade-modal" class="fixed inset-0 hidden flex justify-center items-center p-4 z-[200] bg-black/95 backdrop-blur-md">
        <div class="bg-[#111122] border border-[#2d2d4c] p-10 rounded-[2.5rem] w-full max-w-xl shadow-theme-primary-lg modal-animate">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h3 class="text-2xl font-black text-white uppercase tracking-tighter">录入成交数据</h3>
                    <p class="text-[10px] text-theme-primary font-black uppercase mt-1 tracking-widest">Transaction Entry Protocol</p>
                </div>
                <button onclick="window.closeModal()" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 text-gray-500 hover:text-white transition-colors"><i class="fas fa-times"></i></button>
            </div>
            <form id="trade-form" class="grid grid-cols-2 gap-5">
                <input type="hidden" id="edit-id">
                
                <div class="col-span-1 space-y-1">
                    <label class="text-[10px] text-gray-400 uppercase font-bold tracking-wider">Symbol / 交易对</label>
                    <input id="trade-pair" type="text" placeholder="BTCUSDT" required class="w-full p-3 bg-[#05050a] text-white rounded-xl border border-[#3d3d5c] text-sm focus:border-theme-primary outline-none font-mono">
                </div>
                
                <div class="col-span-1 space-y-1">
                    <label class="text-[10px] text-gray-400 uppercase font-bold tracking-wider">Date / 时间</label>
                    <input id="trade-date" type="text" required class="w-full p-3 bg-[#05050a] text-white rounded-xl border border-[#3d3d5c] text-sm focus:border-theme-primary outline-none font-mono cursor-pointer" placeholder="选择时间...">
                </div>

                <div class="col-span-1 space-y-1">
                    <label class="text-[10px] text-gray-400 uppercase font-bold tracking-wider">Side / 方向</label>
                    <select id="trade-direction" class="w-full p-3 bg-[#05050a] text-white rounded-xl border border-[#3d3d5c] text-sm focus:border-theme-primary outline-none">
                        <option value="Long">Long (做多)</option>
                        <option value="Short">Short (做空)</option>
                    </select>
                </div>

                <div class="col-span-1 space-y-1">
                    <label class="text-[10px] text-gray-400 uppercase font-bold tracking-wider">PnL / 盈亏 ($)</label>
                    <input id="trade-profit" type="number" step="0.01" required class="w-full p-3 bg-[#05050a] text-white rounded-xl border border-[#3d3d5c] text-sm focus:border-theme-primary outline-none font-mono">
                </div>

                <div class="col-span-2 space-y-1">
                    <label class="text-[10px] text-gray-400 uppercase font-bold tracking-wider">Chart Link / 图表链接</label>
                    <input id="trade-tv-link" type="url" placeholder="TradingView URL..." class="w-full p-3 bg-[#05050a] text-white rounded-xl border border-[#3d3d5c] text-sm focus:border-theme-primary outline-none">
                </div>
                
                <div class="col-span-2 pt-4">
                    <button type="submit" class="cyber-button w-full py-4 rounded-xl font-bold uppercase tracking-widest text-sm shadow-lg shadow-theme-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Video Modals Removed -->

    <!-- Hidden File Input for Import -->
    <input type="file" id="import-file" accept=".csv" class="hidden" onchange="processImport(this)">

    <!-- 实时行情 Websocket 脚本 -->
    <script>
        const symbols = ['btcusdt', 'ethusdt', 'dogeusdt'];
        const lastPrices = {};
        let ws = null;
        let reconnectTimeout = null;

        function initWebSocket() {
            if (reconnectTimeout) clearTimeout(reconnectTimeout);

            const streamUrl = `wss://stream.binance.com:9443/stream?streams=${symbols.map(s => s + '@ticker').join('/')}`;
            
            try {
                ws = new WebSocket(streamUrl);
            } catch (e) {
                console.error("WS Init Failed", e);
                scheduleReconnect();
                return;
            }

            ws.onopen = () => {
                console.log('Market Data Connected');
            };

            ws.onmessage = (event) => {
                try {
                    const { data } = JSON.parse(event.data);
                    if (!data) return;
                    
                    const symbol = data.s.toLowerCase();
                    const rawPrice = parseFloat(data.c);
                    const price = rawPrice.toLocaleString(undefined, {
                        minimumFractionDigits: symbol === 'dogeusdt' ? 4 : 2,
                        maximumFractionDigits: symbol === 'dogeusdt' ? 4 : 2
                    });
                    const changePercent = data.P;
                    
                    updatePriceUI(symbol, price, rawPrice, changePercent);
                } catch (err) {
                    console.error("Data parse error", err);
                }
            };

            ws.onerror = (err) => {
                console.error('WS Error', err);
            };

            ws.onclose = () => {
                console.log('Market Data Disconnected. Reconnecting...');
                scheduleReconnect();
            };
        }

        function scheduleReconnect() {
            if (reconnectTimeout) clearTimeout(reconnectTimeout);
            reconnectTimeout = setTimeout(() => {
                if (document.visibilityState === 'visible') {
                    initWebSocket();
                }
            }, 3000);
        }

        function updatePriceUI(symbol, displayPrice, rawPrice, change) {
            const coinPrefix = symbol.replace('usdt', '');
            const priceEl = document.getElementById(`${coinPrefix}-price`);
            const changeEl = document.getElementById(`${coinPrefix}-change`);

            if (!priceEl) return;

            // 价格颜色跳动效果
            if (lastPrices[symbol] && rawPrice !== lastPrices[symbol]) {
                const colorClass = rawPrice > lastPrices[symbol] ? 'text-emerald-400' : 'text-rose-500';
                priceEl.classList.remove('text-white', 'text-emerald-400', 'text-rose-500');
                priceEl.classList.add(colorClass);
                
                // 500ms 后恢复白色
                setTimeout(() => {
                     priceEl.classList.remove('text-emerald-400', 'text-rose-500');
                     priceEl.classList.add('text-white');
                }, 800);
            }
            
            priceEl.innerText = displayPrice;
            lastPrices[symbol] = rawPrice;

            // 涨跌幅样式
            const isPositive = parseFloat(change) >= 0;
            if (changeEl) {
                changeEl.innerText = `${isPositive ? '+' : ''}${parseFloat(change).toFixed(2)}%`;
                changeEl.style.color = isPositive ? '#10b981' : '#f43f5e';
                changeEl.style.backgroundColor = isPositive ? 'rgba(16, 185, 129, 0.1)' : 'rgba(244, 63, 94, 0.1)';
            }
        }

        // Handle visibility change (reconnect when tab comes back)
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                if (!ws || ws.readyState === WebSocket.CLOSED) {
                    initWebSocket();
                }
            }
        });

        // Initial Start
        initWebSocket();


    window.setTheme = (themeName) => {
        const themes = {
            purple: { primary: '#d946ef', primaryRgb: '217, 70, 239', secondary: '#a855f7', secondaryRgb: '168, 85, 247', accent: '#f0abfc' },
            blue: { primary: '#0ea5e9', primaryRgb: '14, 165, 233', secondary: '#3b82f6', secondaryRgb: '59, 130, 246', accent: '#7dd3fc' },
            green: { primary: '#10b981', primaryRgb: '16, 185, 129', secondary: '#22c55e', secondaryRgb: '34, 197, 94', accent: '#6ee7b7' },
            orange: { primary: '#f97316', primaryRgb: '249, 115, 22', secondary: '#ef4444', secondaryRgb: '239, 68, 68', accent: '#fdba74' }
        };

        const t = themes[themeName] || themes.purple;
        const root = document.documentElement;
        
        root.style.setProperty('--primary', t.primary);
        root.style.setProperty('--primary-rgb', t.primaryRgb);
        root.style.setProperty('--secondary', t.secondary);
        root.style.setProperty('--secondary-rgb', t.secondaryRgb);
        root.style.setProperty('--accent', t.accent);
        
        localStorage.setItem('jinmu-theme', themeName);
        
        // Trigger UI Refresh for Canvas/JS-driven styles
        if (typeof refreshUI === 'function') refreshUI();
    };

    // Initialize Theme
    const savedTheme = localStorage.getItem('jinmu-theme') || 'purple';
    window.setTheme(savedTheme);
    
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, doc, addDoc, onSnapshot, deleteDoc, updateDoc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = JSON.parse('{"apiKey":"AIzaSyDhzGgJ-Jjb6Ouztk2aV3WvPHimEJ1wagU","authDomain":"jinmu-c0549.firebaseapp.com","projectId":"jinmu-c0549","storageBucket":"jinmu-c0549.firebasestorage.app","messagingSenderId":"433198268542","appId":"1:433198268542:web:e3a1bb8aedd22c4db8982f"}');
const appId = 'jinmu-v8-ultra-isolated'; // 使用隔离版 ID

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let allTrades = [];
let config = { initialCapital: 10000, targetCapital: 20000 };
let chartInstance = null;
let analyticsCharts = { pnl: null, roi: null, wr: null, count: null };
let analyticsYear = new Date().getFullYear();
let viewMode = 'month';
let chartMode = 'all';
let unsubscribeTrades = null;

// --- LEARN MODULE CONFIGURATION ---
// MODIFY THIS ARRAY TO CHANGE VIDEOS
const LEARN_VIDEOS = [
    {
        title: "TTrades Top-Down Chart Lessons #1",
        url: "https://www.youtube.com/watch?v=Nlw-PZhoViQ"
    },
    {
        title: "TTrades Top-Down Chart Lessons #2",
        url: "https://www.youtube.com/watch?v=UBTl7za9obc&t=219s" 
    },
    {
        title: "TTrades Top-Down Chart Lessons #3",
        url: "https://www.youtube.com/watch?v=IzOQmcgLyA0"
    },
    {
        title: "TTrades Top-Down Chart Lessons #4",
        url: "https://www.youtube.com/watch?v=w-JekHg6Ldk"
    },
    {
        title: "TTrades Fractal Model - Trading Candle 2",
        url: "https://www.youtube.com/watch?v=m4k_1pF5zFI"
    },
    {
        title: "TTrades Fractal Model - Trading Candle 3",
        url: "https://www.youtube.com/watch?v=qdQYhePcvGE"
    }
];

// 初始化身份验证（支持环境自动登录）
const initAuth = async () => {
    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
        await signInWithCustomToken(auth, __initial_auth_token);
    } else {
        // 如果没有预设 token，不强制匿名登录，让用户手动输入
    }
};
initAuth();

onAuthStateChanged(auth, async (user) => {
    if (user) {
        document.getElementById('video-overlay').style.opacity = '1';
        document.getElementById('auth-view').classList.add('hidden-view');
        document.getElementById('main-view').classList.remove('hidden-view');
        document.getElementById('user-display-name').textContent = (user.email ? user.email.split('@')[0] : 'USER').toUpperCase();
        
        // 1. 获取独立配置
        const configRef = doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'config');
        const configSnap = await getDoc(configRef);
        if (configSnap.exists()) {
            config = { ...config, ...configSnap.data() };
            document.getElementById('initial-capital').value = config.initialCapital;
            document.getElementById('target-capital').value = config.targetCapital;
        }

        const now = new Date();
        const currentMonthVal = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
        
        // Initialize Custom Date Picker
        initPickers();

        // 2. 数据隔离监听
        if (unsubscribeTrades) unsubscribeTrades();
        unsubscribeTrades = onSnapshot(collection(db, 'artifacts', appId, 'users', user.uid, 'trades'), (snap) => {
            allTrades = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            const syncTimeEl = document.getElementById('last-sync-time');
            if (syncTimeEl) syncTimeEl.textContent = `Synced: ${new Date().toLocaleTimeString()}`;
            
            // 延迟刷新以确保 DOM 布局就绪 (解决首次加载图表不显示的问题)
            setTimeout(() => {
                populateFilters();
                refreshUI();
            }, 50);
        });

        // 3. Videos (Static Render)
        renderVideos();

    } else {
        document.getElementById('video-overlay').style.opacity = '0';
        document.getElementById('main-view').classList.add('hidden-view');
        document.getElementById('auth-view').classList.remove('hidden-view');
        if (unsubscribeTrades) unsubscribeTrades();
    }
});

// View Switching Logic
window.switchView = (viewId) => {
    // Update Nav
    document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
    document.getElementById(`nav-${viewId}`)?.classList.add('active');
    
    // Update View Sections
    document.querySelectorAll('.view-section').forEach(el => {
        el.classList.remove('active');
        el.classList.add('hidden');
    });
    const target = document.getElementById(`view-${viewId}`);
    if (target) {
        target.classList.add('active');
        target.classList.remove('hidden');
    }
    
    // Refresh UI if needed (e.g. resizing charts)
    if (viewId === 'dashboard' || viewId === 'analytics') refreshUI();
};

function populateFilters() {
    renderYearDropdown();
    renderMonthDropdown();
}

const saveConfig = async () => {
    if (!auth.currentUser) return;
    config.initialCapital = parseFloat(document.getElementById('initial-capital').value) || 10000;
    config.targetCapital = parseFloat(document.getElementById('target-capital').value) || 20000;
    await setDoc(doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'settings', 'config'), config);
    refreshUI();
};
document.getElementById('initial-capital').onchange = saveConfig;
document.getElementById('target-capital').onchange = saveConfig;

// --- 以下是保持不变的 UI 渲染逻辑 ---

function refreshUI() {
    allTrades.sort((a, b) => new Date(a.date) - new Date(b.date));
    const now = new Date();
    let filtered = [];
    
    // Safety check: ensure year/month have defaults if inputs are empty
    let y = Number(document.getElementById('global-year').value);
    let m = Number(document.getElementById('global-month').value);
    
    if (!y || !m) {
        y = now.getFullYear();
        m = now.getMonth() + 1;
        // Update inputs to reflect defaults
        if(document.getElementById('global-year')) document.getElementById('global-year').value = y;
        if(document.getElementById('global-month')) document.getElementById('global-month').value = String(m).padStart(2, '0');
    }
    
    filtered = allTrades.filter(t => {
        const d = new Date(t.date);
        return d.getFullYear() === y && (d.getMonth() + 1) === m;
    });

    updateGoalProgress(allTrades);
    updateMetricCards(allTrades); 
    
    // Sync Calendar Widget Month (if it exists)
    const calSelect = document.getElementById('calendar-month-select');
    if (calSelect) calSelect.value = `${y}-${String(m).padStart(2,'0')}`;

    renderCalendar(allTrades); 
    renderTradeList(filtered);
    renderMiniTradeList(allTrades); // Add this
    updateChart(allTrades, filtered); // Equity chart needs base equity (allTrades) and view data (filtered)

    if (document.getElementById('view-analytics').classList.contains('active')) {
        updateAnalyticsCharts(allTrades);
    }
}

function updateAnalyticsCharts(all) {
    // 1. Group Data by Month for Selected Year
    const stats = {};
    const sorted = all.slice().sort((a, b) => new Date(a.date) - new Date(b.date));
    let runningEquity = config.initialCapital;
    
    // Initialize all 12 months for the selected year
    for(let m=1; m<=12; m++) {
        const key = `${analyticsYear}-${String(m).padStart(2,'0')}`;
        stats[key] = { pnl: 0, wins: 0, total: 0, startEquity: runningEquity };
    }

    // Process Trades
    sorted.forEach(t => {
        const d = new Date(t.date);
        const y = d.getFullYear();
        if (y < analyticsYear) {
            runningEquity += t.profit; // Keep track of equity before this year
        } else if (y === analyticsYear) {
            const key = `${analyticsYear}-${String(d.getMonth() + 1).padStart(2, '0')}`;
            // If month bucket exists (it should), update it
            if(stats[key]) {
                // Fix startEquity for the month: it should be equity BEFORE the first trade of the month
                // But simplified: runningEquity at start of loop is equity before this trade.
                // We need logic to capture equity at start of month.
                // Actually, simplest way: Calculate running equity continuously.
            }
        }
    });
    
    // Re-run loop with correct equity tracking
    runningEquity = config.initialCapital;
    sorted.forEach(t => {
        const d = new Date(t.date);
        const y = d.getFullYear();
        const key = `${y}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        
        if (y === analyticsYear) {
            if (!stats[key].hasData) {
                stats[key].startEquity = runningEquity;
                stats[key].hasData = true;
            }
            stats[key].pnl += t.profit;
            stats[key].total++;
            if (t.profit > 0) stats[key].wins++;
        }
        runningEquity += t.profit;
    });

    const labels = Object.keys(stats).sort(); // Jan to Dec
    const monthNames = ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"];
    const displayLabels = labels.map(k => monthNames[parseInt(k.split('-')[1])-1]);
    
    const pnlData = labels.map(k => stats[k].pnl);
    const roiData = labels.map(k => {
        const equity = stats[k].startEquity || config.initialCapital; // Fallback
        return equity > 0 ? (stats[k].pnl / equity) * 100 : 0;
    });
    const wrData = labels.map(k => stats[k].total > 0 ? (stats[k].wins / stats[k].total) * 100 : 0);
    const countData = labels.map(k => stats[k].total);

    // Helper for Chart Config
    const createConfig = (label, data, colorCallback, unit = '') => ({
        type: 'bar',
        data: {
            labels: displayLabels,
            datasets: [{
                label: label,
                data: data,
                backgroundColor: colorCallback,
                borderRadius: 6,
                borderSkipped: false,
                barPercentage: 0.6,
                categoryPercentage: 0.8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                datalabels: {
                    color: '#fff',
                    font: { weight: '900', size: 13, family: 'Inter' },
                    anchor: 'end',
                    align: 'end',
                    offset: -4,
                    textShadowBlur: 4,
                    textShadowColor: 'rgba(0,0,0,0.8)',
                    formatter: (val) => val === 0 ? '' : (unit === '$' && val > 0 ? '+' : '') + val.toFixed(unit === '' ? 0 : 2) + unit
                },
                tooltip: { 
                    callbacks: { label: (c) => `${c.raw.toFixed(2)}${unit}` },
                    backgroundColor: '#111122',
                    titleFont: { size: 12 },
                    bodyFont: { size: 14, weight: 'bold' }
                }
            },
            layout: {
                padding: {
                    top: 25,
                    left: 10,
                    right: 10,
                    bottom: 0
                }
            },
            scales: {
                x: { grid: { display: false }, ticks: { color: '#9ca3af', font: {size: 11, weight: 'bold'} } },
                y: { 
                    grid: { color: 'rgba(255,255,255,0.05)' }, 
                    ticks: { color: '#6b7280', font: {size: 11, weight: 'bold'} },
                    grace: '10%' 
                }
            }
        },
        plugins: [ChartDataLabels]
    });

    // Render PnL Chart
    const ctxPnL = document.getElementById('analytics-pnl-chart').getContext('2d');
    if (analyticsCharts.pnl) analyticsCharts.pnl.destroy();
    analyticsCharts.pnl = new Chart(ctxPnL, createConfig('PnL', pnlData, (c) => {
        return c.raw >= 0 ? '#10b981' : '#ef4444';
    }, '$'));

    // Render ROI Chart
    const ctxROI = document.getElementById('analytics-roi-chart').getContext('2d');
    if (analyticsCharts.roi) analyticsCharts.roi.destroy();
    analyticsCharts.roi = new Chart(ctxROI, createConfig('ROI', roiData, (c) => {
        return c.raw >= 0 ? '#3b82f6' : '#f59e0b';
    }, '%'));

    // Render Win Rate Chart
    const ctxWR = document.getElementById('analytics-wr-chart').getContext('2d');
    if (analyticsCharts.wr) analyticsCharts.wr.destroy();
    analyticsCharts.wr = new Chart(ctxWR, createConfig('Win Rate', wrData, '#eab308', '%'));

    // Render Count Chart
    const ctxCount = document.getElementById('analytics-count-chart').getContext('2d');
    if (analyticsCharts.count) analyticsCharts.count.destroy();
    analyticsCharts.count = new Chart(ctxCount, createConfig('Trades', countData, '#a855f7', ''));
}

function updateGoalProgress(all) {
    const initial = config.initialCapital;
    const target = config.targetCapital;
    let currentEquity = initial;
    all.forEach(t => currentEquity += t.profit);
    const neededToEarn = target - initial;
    const alreadyEarned = currentEquity - initial;
    let progress = neededToEarn > 0 ? Math.max(0, (alreadyEarned / neededToEarn) * 100) : 0;
    document.getElementById('goal-percent').textContent = `${progress.toFixed(1)}%`;
    const circle = document.getElementById('goal-progress-bar');
    const circumference = 276.46; 
    circle.style.strokeDashoffset = circumference - (Math.min(100, progress) / 100 * circumference);
    const remaining = target - currentEquity;
    
    // Update Dashboard Display
    const targetDisplay = document.getElementById('dashboard-target-display');
    if (targetDisplay) targetDisplay.textContent = target.toLocaleString();

    document.getElementById('remaining-label').textContent = remaining > 0 ? `距目标还差 $${remaining.toLocaleString()}` : 'GOAL REACHED / 目标已达成';
    document.getElementById('remaining-label').className = remaining > 0 ? 'text-[10px] text-gray-400 italic font-bold' : 'text-[10px] text-emerald-400 font-black animate-pulse';
}

function updateMetricCards(all) {
    const initial = config.initialCapital;
    let currentEquity = initial;
    let maxEquity = initial;
    let maxDD = 0, totalProfit = 0, totalLoss = 0, winCount = 0, lossCount = 0, totalR = 0;
    all.forEach(t => {
        currentEquity += t.profit;
        totalR += t.r;
        if (t.profit > 0) { totalProfit += t.profit; winCount++; }
        else { totalLoss += Math.abs(t.profit); lossCount++; }
        if (currentEquity > maxEquity) maxEquity = currentEquity;
        const dd = ((maxEquity - currentEquity) / maxEquity) * 100;
        if (dd > maxDD) maxDD = dd;
    });
    const wr = all.length ? (winCount / all.length * 100) : 0;
    const pf = totalLoss === 0 ? totalProfit : (totalProfit / totalLoss);
    const roi = initial > 0 ? ((currentEquity - initial) / initial) * 100 : 0;
    
    const metrics = [
        { label: '账户总资产', val: `${currentEquity.toFixed(2)}`, sub: '当前余额 (Balance)', cls: 'text-white' },
        { label: '统计胜率', val: `${wr.toFixed(1)}%`, sub: `${winCount}胜 / ${lossCount}负`, cls: 'text-theme-primary' },
        { label: '盈亏系数 PF', val: pf.toFixed(2), sub: '盈亏比 (Factor)', cls: pf >= 1.5 ? 'text-emerald-400' : 'text-amber-400' },
        { label: '极限回撤 DD', val: `${maxDD.toFixed(1)}%`, sub: '最大回撤 (Drawdown)', cls: 'text-rose-400' },
        { label: '单笔均值 R', val: `${(totalR/Math.max(1,all.length)).toFixed(2)}R`, sub: '平均R值 (Avg R)', cls: 'text-indigo-400' },
        { label: '总收益率 ROI', val: `${roi > 0 ? '+' : ''}${roi.toFixed(2)}%`, sub: '总回报率 (Return)', cls: roi >= 0 ? 'text-emerald-500' : 'text-rose-500' },
        { label: '核心净利润', val: `${(currentEquity - initial).toFixed(2)}`, sub: '净利润 (Net Profit)', cls: (currentEquity >= initial) ? 'text-emerald-400' : 'text-rose-400' },
        { label: '总交易数', val: all.length, sub: '总笔数 (Count)', cls: 'text-gray-400' }
    ];
    document.getElementById('metrics-grid').innerHTML = metrics.map(m => `
        <div class="metric-card p-4 rounded-2xl component-bg border border-white/5 flex flex-col justify-center h-full">
            <p class="text-[10px] md:text-xs uppercase text-gray-500 font-black tracking-widest mb-2">${m.label}</p>
            <p class="text-xl md:text-2xl font-black ${m.cls}">${m.val}</p>
            <p class="text-[10px] md:text-xs text-gray-600 mt-2 uppercase font-black tracking-tight">${m.sub}</p>
        </div>`).join('');
}

function renderCalendar(data) {
    const y = Number(document.getElementById('global-year').value);
    const m = Number(document.getElementById('global-month').value);
    const year = y || new Date().getFullYear();
    const month = (m ? Number(m) : (new Date().getMonth() + 1)) - 1;
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const startOffset = (firstDay === 0 ? 6 : firstDay - 1);
    const dailyPnL = {};
    data.forEach(t => {
        const d = new Date(t.date);
        if (d.getFullYear() === year && d.getMonth() === month) {
            const day = d.getDate();
            dailyPnL[day] = (dailyPnL[day] || 0) + t.profit;
        }
    });
    let html = '';
    for (let i = 0; i < startOffset; i++) html += '<div class="calendar-day opacity-0 pointer-events-none"></div>';
    for (let d = 1; d <= daysInMonth; d++) {
        const pnl = dailyPnL[d];
        let cls = 'day-empty', pnlLabel = '';
        if (pnl !== undefined) { 
            cls = pnl >= 0 ? 'day-profit' : 'day-loss'; 
            pnlLabel = `<span class="font-black mt-1">${pnl >= 0 ? '+' : ''}${Math.round(pnl)}</span>`; 
        }
        html += `<div class="calendar-day ${cls} cursor-pointer group"><span class="opacity-50 font-bold group-hover:opacity-100">${d}</span>${pnlLabel}</div>`;
    }
    document.getElementById('calendar-heatmap').innerHTML = html;
}

function renderTradeList(filteredData) {
    const search = document.getElementById('table-search')?.value.toUpperCase() || "";
    // filter-status was removed in HTML, so we ignore it or add it back to toolbar if needed.
    // The new toolbar has strategy/pair.
    
    const list = filteredData.filter(t => {
        const matchSearch = (t.pair + t.strategy + t.tags).toUpperCase().includes(search);
        return matchSearch;
    });
    
    const body = document.getElementById('trade-list');
    const empty = document.getElementById('empty-state');
    // document.getElementById('log-count').textContent = list.length; // Removed in new HTML
    
    if (list.length === 0) { body.innerHTML = ''; empty.classList.remove('hidden'); return; }
    empty.classList.add('hidden');
    
    body.innerHTML = list.slice().reverse().map(t => {
        const tvLink = t.tvLink || `https://www.tradingview.com/chart/?symbol=${t.pair.replace('/','')}`;
        const pnlClass = t.profit >= 0 ? 'text-emerald-400' : 'text-rose-400';
        const pnlSign = t.profit >= 0 ? '+' : '';
        
        return `
        <tr class="trade-row border-b border-white/5 hover:bg-white/5 transition-colors">
            <td class="px-4 py-4 text-gray-400 font-mono">${new Date(t.date).toLocaleString('zh-CN', {month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit'})}</td>
            <td class="px-4 py-4 font-bold text-white tracking-tight">${t.pair}</td>
            <td class="px-4 py-4 text-center">
                <span class="px-2 py-1 rounded text-[10px] font-bold uppercase ${t.direction === 'Long' ? 'bg-emerald-500/10 text-emerald-400' : 'bg-rose-500/10 text-rose-400'}">
                    ${t.direction}
                </span>
            </td>
            <td class="px-4 py-4 text-right font-bold text-base ${pnlClass}">${pnlSign}${t.profit.toFixed(2)}</td>
            <td class="px-4 py-4 text-right">
                <div class="flex items-center justify-end space-x-2">
                    ${t.tvLink ? `<a href="${t.tvLink}" target="_blank" class="action-icon flex items-center justify-center text-gray-500 hover:text-theme-primary transition-colors" title="Chart"><i class="fas fa-chart-line"></i></a>` : ''}
                    <button onclick="window.editTrade('${t.id}')" class="action-icon flex items-center justify-center text-gray-500 hover:text-white transition-colors">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="window.deleteTrade('${t.id}')" class="action-icon flex items-center justify-center text-gray-500 hover:text-rose-500 transition-colors">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        </tr>
    `}).join('');
}

function renderMiniTradeList(all) {
    const list = all.slice().sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 8);
    const container = document.getElementById('mini-trade-list');
    const empty = document.getElementById('mini-empty-state');
    
    if (list.length === 0) {
        container.innerHTML = '';
        if(empty) empty.classList.remove('hidden');
        return;
    }
    if(empty) empty.classList.add('hidden');

    container.innerHTML = list.map(t => {
        const pnlColor = t.profit >= 0 ? 'text-emerald-400' : 'text-rose-400';
        return `
        <tr class="border-b border-white/5 hover:bg-white/5 transition-colors cursor-pointer" onclick="window.editTrade('${t.id}')">
            <td class="py-3 pl-2 text-left font-mono opacity-80">${t.pair}</td>
            <td class="py-3 text-center">
                <span class="text-xs px-2 py-1 rounded ${t.direction === 'Long' ? 'bg-emerald-500/10 text-emerald-400' : 'bg-rose-500/10 text-rose-400'}">${t.direction.toUpperCase().substring(0,1)}</span>
            </td>
            <td class="py-3 pr-2 text-right font-black ${pnlColor}">${t.profit >= 0 ? '+' : ''}${t.profit.toFixed(0)}</td>
        </tr>
        `;
    }).join('');
}

function updateChart(all, viewData) {
    const initial = config.initialCapital;
    let currentViewPnL = 0, baseEquity = initial;

    // 1. Calculate View Stats (Selected Month Data)
    const y = Number(document.getElementById('global-year').value);
    const m = Number(document.getElementById('global-month').value);
    const monthStart = new Date(y, m - 1, 1);
    
    // Calculate PnL for the View (Month)
    viewData.forEach(t => currentViewPnL += t.profit);
    
    // Calculate Equity at the start of the selected month
    let preMonthProfit = 0;
    all.forEach(t => { 
        if (new Date(t.date) < monthStart) preMonthProfit += t.profit; 
    });
    baseEquity = initial + preMonthProfit;

    // Update Stats DOM (Always reflect the selected Month/View Stats)
    document.getElementById('view-pnl').textContent = `${currentViewPnL >= 0 ? '+' : ''}$${currentViewPnL.toFixed(2)}`;
    document.getElementById('view-pnl').className = `text-2xl font-black font-mono mt-1 ${currentViewPnL >= 0 ? 'text-emerald-400' : 'text-rose-400'}`;
    document.getElementById('view-count').textContent = viewData.length;
    
    const monthROI = baseEquity > 0 ? (currentViewPnL / baseEquity) * 100 : 0;
    document.getElementById('view-roi').textContent = `${monthROI > 0 ? '+' : ''}${monthROI.toFixed(2)}%`;
    document.getElementById('view-roi').className = `text-2xl font-black font-mono mt-1 ${monthROI >= 0 ? 'text-emerald-400' : 'text-rose-400'}`;
    
    // 2. Generate Chart Data based on chartMode
    const pts = [];
    
    if (chartMode === 'all') {
        // ALL Mode: From Initial Capital -> Now (All Trades)
        let running = initial;
        // Start point: 1 day before first trade or today
        if (all.length > 0) {
            pts.push({ x: new Date(new Date(all[0].date).getTime() - 86400000), y: initial });
        } else {
            pts.push({ x: new Date(), y: initial });
        }
        
        all.forEach(t => {
            running += t.profit;
            pts.push({ x: new Date(t.date), y: running });
        });
    } else {
        // VIEW Mode: Selected Month Equity Curve
        // Start point: 1st of the month with baseEquity
        pts.push({ x: monthStart, y: baseEquity });
        
        let running = baseEquity;
        viewData.forEach(t => {
            running += t.profit;
            pts.push({ x: new Date(t.date), y: running });
        });
    }
    
    const ctx = document.getElementById('equity-chart').getContext('2d');
    
    // Get Dynamic Colors
    const style = getComputedStyle(document.body);
    const primary = style.getPropertyValue('--primary').trim() || '#d946ef';
    const primaryRgb = style.getPropertyValue('--primary-rgb').trim() || '217, 70, 239';

    if (chartInstance) chartInstance.destroy();
    chartInstance = new Chart(ctx, {
        type: 'line',
        data: { datasets: [{ 
            data: pts, borderColor: primary, borderWidth: 3, pointRadius: 4, pointBackgroundColor: primary, fill: true,
            backgroundColor: (c) => { 
                const g = c.chart.ctx.createLinearGradient(0, 0, 0, 400); 
                g.addColorStop(0, `rgba(${primaryRgb}, 0.2)`); 
                g.addColorStop(1, `rgba(${primaryRgb}, 0)`); 
                return g; 
            },
            tension: 0.15 
        }] },
        options: { 
            responsive: true, maintainAspectRatio: false, 
            plugins: { legend: { display: false }, tooltip: { padding: 12, backgroundColor: '#111122', titleFont: { size: 12, weight: 'bold' }, bodyFont: { size: 14, weight: 'black' } } },
            scales: { 
                x: { type: 'time', grid: { display: false }, ticks: { color: '#4b5563', font: {size: 10, weight: 'bold'} } }, 
                y: { grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#4b5563', font: {size: 10, weight: 'bold'} } } 
            } 
        }
    });
}

window.changeMonth = (off) => {
    let y = Number(document.getElementById('global-year').value);
    let m = Number(document.getElementById('global-month').value);
    
    const date = new Date(y, m - 1 + off, 1);
    selectYear(date.getFullYear(), false);
    selectMonth(String(date.getMonth() + 1).padStart(2,'0'), true);
};

document.getElementById('btn-current-month').onclick = () => {
    const now = new Date();
    selectYear(now.getFullYear(), false);
    selectMonth(String(now.getMonth() + 1).padStart(2,'0'), true);
};

// document.getElementById('global-date-picker').onchange = refreshUI; // Deprecated
// document.getElementById('global-pair-filter').onchange = refreshUI; // Deprecated
document.getElementById('table-search')?.addEventListener('input', refreshUI);

// --- Custom Picker Logic (Year / Month / Pair) ---

// Initialize all pickers
window.initPickers = () => {
    const now = new Date();
    const currentY = now.getFullYear();
    const currentM = String(now.getMonth() + 1).padStart(2, '0');

    // Init Values if empty
    if(!document.getElementById('global-year').value) selectYear(currentY, false);
    if(!document.getElementById('global-month').value) selectMonth(currentM, false);
    
    // Render Dropdowns
    renderYearDropdown();
    renderMonthDropdown();
    
    // Close listeners
    // Initialize Analytics Picker
    renderAnalyticsYearDropdown();
    document.getElementById('analytics-year-label').textContent = analyticsYear;

    document.addEventListener('click', (e) => {
        if (!document.getElementById('year-picker-container').contains(e.target)) {
            document.getElementById('year-picker-dropdown').classList.add('hidden');
        }
        if (!document.getElementById('month-picker-container').contains(e.target)) {
            document.getElementById('month-picker-dropdown').classList.add('hidden');
        }
        if (!document.getElementById('analytics-year-picker-container').contains(e.target)) {
            document.getElementById('analytics-year-picker-dropdown').classList.add('hidden');
        }
    });
};

// Analytics Year Picker Logic
window.toggleAnalyticsYearPicker = () => document.getElementById('analytics-year-picker-dropdown').classList.toggle('hidden');
window.renderAnalyticsYearDropdown = () => {
    const currentY = new Date().getFullYear();
    const startY = currentY - 2;
    const endY = currentY + 1;
    let html = '';
    for (let y = endY; y >= startY; y--) {
        const isSelected = String(y) === String(analyticsYear);
        html += `
            <div onclick="selectAnalyticsYear('${y}')" 
                 class="px-4 py-2 text-xs font-bold text-gray-300 hover:bg-theme-primary-20 hover:text-white cursor-pointer transition-colors flex justify-between items-center rounded-lg mb-1 ${isSelected ? 'bg-white/5 text-theme-primary' : ''}">
                <span>${y}</span>
                ${isSelected ? '<i class="fas fa-check text-theme-primary text-[10px]"></i>' : ''}
            </div>`;
    }
    document.getElementById('analytics-year-picker-dropdown').innerHTML = html;
};
window.selectAnalyticsYear = (y) => {
    analyticsYear = Number(y);
    document.getElementById('analytics-year-label').textContent = y;
    document.getElementById('analytics-year-picker-dropdown').classList.add('hidden');
    renderAnalyticsYearDropdown();
    refreshUI(); // Re-render analytics charts
};

// Year Picker
window.toggleYearPicker = () => document.getElementById('year-picker-dropdown').classList.toggle('hidden');
window.renderYearDropdown = () => {
    const currentY = new Date().getFullYear();
    const startY = currentY - 2;
    const endY = currentY + 1;
    const selected = document.getElementById('global-year').value;
    let html = '';
    for (let y = endY; y >= startY; y--) {
        const isSelected = String(y) === String(selected);
        html += `
            <div onclick="selectYear('${y}')" 
                 class="px-4 py-2 text-xs font-bold text-gray-300 hover:bg-theme-primary-20 hover:text-white cursor-pointer transition-colors flex justify-between items-center rounded-lg mb-1 ${isSelected ? 'bg-white/5 text-theme-primary' : ''}">
                <span>${y}</span>
                ${isSelected ? '<i class="fas fa-check text-theme-primary text-[10px]"></i>' : ''}
            </div>`;
    }
    document.getElementById('year-picker-dropdown').innerHTML = html;
};
window.selectYear = (y, refresh = true) => {
    document.getElementById('global-year').value = y;
    document.getElementById('year-picker-label').textContent = y;
    document.getElementById('year-picker-dropdown').classList.add('hidden');
    renderYearDropdown(); 
    if(refresh) refreshUI();
};

// Month Picker
window.toggleMonthPicker = () => document.getElementById('month-picker-dropdown').classList.toggle('hidden');
window.renderMonthDropdown = () => {
    const selected = document.getElementById('global-month').value;
    let html = '';
    for (let m = 1; m <= 12; m++) {
        const val = String(m).padStart(2, '0');
        const isSelected = val === String(selected);
        html += `
            <div onclick="selectMonth('${val}')" 
                 class="px-4 py-2 text-xs font-bold text-gray-300 hover:bg-theme-primary-20 hover:text-white cursor-pointer transition-colors flex justify-between items-center rounded-lg mb-1 ${isSelected ? 'bg-white/5 text-theme-primary' : ''}">
                <span>${m}月</span>
                ${isSelected ? '<i class="fas fa-check text-theme-primary text-[10px]"></i>' : ''}
            </div>`;
    }
    document.getElementById('month-picker-dropdown').innerHTML = html;
};
window.selectMonth = (m, refresh = true) => {
    document.getElementById('global-month').value = m;
    document.getElementById('month-picker-label').textContent = `${Number(m)}月`;
    document.getElementById('month-picker-dropdown').classList.add('hidden');
    renderMonthDropdown();
    if(refresh) refreshUI();
};


// --- Import / Export Logic (Chinese Comments) ---

window.triggerImport = () => {
    document.getElementById('import-file').click();
};

window.processImport = (input) => {
    const file = input.files[0];
    if (!file) return;

    Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: async (results) => {
            if (results.errors.length > 0) {
                alert("CSV 解析错误: " + results.errors[0].message);
                return;
            }

            const rows = results.data;
            let importedCount = 0;
            let errorCount = 0;

            // 必填列检查
            const requiredCols = ['Date', 'Symbol', 'Side', 'PnL']; 
            
            const headers = results.meta.fields;
            const missing = requiredCols.filter(c => !headers.includes(c));
            if (missing.length > 0) {
                alert(`CSV 校验失败。缺少列: ${missing.join(', ')}`);
                return;
            }

            if (!confirm(`发现 ${rows.length} 条记录。确认导入？`)) return;

            for (const row of rows) {
                try {
                    // 数据转换与验证
                    const trade = {
                        date: row['Date'] || new Date().toISOString(),
                        pair: (row['Symbol'] || 'UNKNOWN').toUpperCase(),
                        direction: ['Long', 'Short'].includes(row['Side']) ? row['Side'] : 'Long',
                        qty: parseFloat(row['Qty']) || 0,
                        entry: parseFloat(row['Entry']) || 0,
                        exit: parseFloat(row['Exit']) || 0,
                        profit: parseFloat(row['PnL']) || 0,
                        fee: parseFloat(row['Fee']) || 0,
                        r: parseFloat(row['R']) || 0,
                        strategy: row['Strategy'] || '',
                        tags: row['Tags'] || '',
                        tvLink: '' // 默认为空
                    };

                    // 简单逻辑检查
                    if (isNaN(trade.profit)) throw new Error("无效的盈亏数值");

                    await addDoc(collection(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'trades'), trade);
                    importedCount++;
                } catch (err) {
                    console.error("行导入失败:", row, err);
                    errorCount++;
                }
            }
            
            alert(`导入完成。\n成功: ${importedCount}\n失败: ${errorCount}`);
            input.value = ''; // 重置
        }
    });
};

window.exportToCSV = () => {
    const y = Number(document.getElementById('global-year').value);
    const m = Number(document.getElementById('global-month').value);
    const search = document.getElementById('table-search')?.value.toUpperCase() || "";

    const filtered = allTrades.filter(t => {
        const d = new Date(t.date);
        const matchDate = d.getFullYear() === y && (d.getMonth() + 1) === m;
        const matchSearch = (t.pair + t.strategy + (t.tags||"")).toUpperCase().includes(search);
        return matchDate && matchSearch;
    });

    if (filtered.length === 0) {
        alert("当前筛选条件下无数据可导出。");
        return;
    }

    const csvData = filtered.map(t => ({
        Date: t.date,
        Symbol: t.pair,
        Side: t.direction,
        Qty: t.qty,
        Entry: t.entry,
        Exit: t.exit,
        PnL: t.profit,
        Fee: t.fee,
        R: t.r,
        Strategy: t.strategy,
        Tags: t.tags
    }));

    const csv = Papa.unparse(csvData);
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    const filename = `jinmu_trades_export_${y}-${String(m).padStart(2,'0')}.csv`;
    link.setAttribute('href', url);
    link.setAttribute('download', filename);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
};

document.getElementById('chart-mode-view').onclick = () => { 
    chartMode = 'view'; 
    updateChartModeUI(); 
    refreshUI(); 
};
document.getElementById('chart-mode-all').onclick = () => { 
    chartMode = 'all'; 
    updateChartModeUI(); 
    refreshUI(); 
};

function updateChartModeUI() {
    const btnView = document.getElementById('chart-mode-view');
    const btnAll = document.getElementById('chart-mode-all');
    const activeClass = 'bg-theme-primary text-black shadow-lg shadow-theme-primary-sm';
    const inactiveClass = 'text-gray-400 hover:text-white bg-transparent shadow-none';
    const baseClass = 'px-3 py-1 text-[10px] font-black rounded-md transition-all';
    
    btnView.className = `${baseClass} ${chartMode === 'view' ? activeClass : inactiveClass}`;
    btnAll.className = `${baseClass} ${chartMode === 'all' ? activeClass : inactiveClass}`;
}

// Flatpickr Instance
let datePickerInstance = null;

window.openModal = () => {
    document.getElementById('trade-form').reset();
    document.getElementById('edit-id').value = "";
    
    // Initialize or Update Flatpickr
    const now = new Date();
    if (!datePickerInstance) {
        datePickerInstance = flatpickr("#trade-date", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            time_24hr: true,
            defaultDate: now,
            locale: "zh",
            theme: "dark",
            disableMobile: "true"
        });
    } else {
        datePickerInstance.setDate(now);
    }
    
    document.getElementById('trade-modal').classList.remove('hidden');
};
window.closeModal = () => document.getElementById('trade-modal').classList.add('hidden');

document.getElementById('trade-form').onsubmit = async (e) => {
    e.preventDefault();
    if (!auth.currentUser) return;
    
    // Construct Date from Flatpickr
    const rawDate = document.getElementById('trade-date').value;
    const dateObj = new Date(rawDate);
    const isoDate = !isNaN(dateObj) ? dateObj.toISOString() : new Date().toISOString();

    const trade = { 
        pair: document.getElementById('trade-pair').value.toUpperCase(), 
        date: isoDate,
        direction: document.getElementById('trade-direction').value,
        profit: parseFloat(document.getElementById('trade-profit').value),
        tvLink: document.getElementById('trade-tv-link').value,
        // Defaults for removed fields
        qty: 0, entry: 0, exit: 0, fee: 0, r: 0, strategy: "", tags: ""
    };
    const eid = document.getElementById('edit-id').value;
    if (eid) await updateDoc(doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'trades', eid), trade);
    else await addDoc(collection(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'trades'), trade);
    window.closeModal();
};

window.deleteTrade = async (id) => { 
    if(confirm("确定要删除这条记录吗？")) 
        await deleteDoc(doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'trades', id)); 
};

window.editTrade = (id) => {
    const t = allTrades.find(x => x.id === id);
    document.getElementById('edit-id').value = t.id;
    document.getElementById('trade-pair').value = t.pair;
    document.getElementById('trade-direction').value = t.direction;
    document.getElementById('trade-profit').value = t.profit;
    document.getElementById('trade-tv-link').value = t.tvLink || "";
    
    if (!datePickerInstance) {
         datePickerInstance = flatpickr("#trade-date", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            time_24hr: true,
            locale: "zh",
            theme: "dark",
            disableMobile: "true"
        });
    }
    datePickerInstance.setDate(new Date(t.date));
    
    document.getElementById('trade-modal').classList.remove('hidden');
};

document.getElementById('auth-form').onsubmit = async (e) => {
    e.preventDefault();
    try { 
        await signInWithEmailAndPassword(auth, document.getElementById('auth-email').value, document.getElementById('auth-password').value); 
    } catch (err) { alert("访问被拒绝: " + err.message); }
};
document.getElementById('btn-register').onclick = async () => {
    try { 
        await createUserWithEmailAndPassword(auth, document.getElementById('auth-email').value, document.getElementById('auth-password').value); 
    } catch (err) { alert("注册失败: " + err.message); }
};
document.getElementById('btn-logout').onclick = () => signOut(auth);

const calcRiskAmount = document.getElementById('calc-risk-amount');
const calcRiskPercent = document.getElementById('calc-risk-percent');
const calcResult = document.getElementById('calc-result');
function updatePositionSize() {
    const risk = parseFloat(calcRiskAmount?.value) || 0;
    const percent = parseFloat(calcRiskPercent?.value) || 0;
    const size = risk > 0 && percent > 0 ? (risk / (percent / 100)) : 0;
    if (calcResult) calcResult.textContent = '$' + size.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
}
if (calcRiskAmount && calcRiskPercent) {
    calcRiskAmount.oninput = updatePositionSize;
    calcRiskPercent.oninput = updatePositionSize;
    updatePositionSize();
}

// --- Video / Learn Module Logic ---

function getYouTubeId(url) {
    if (!url) return null;
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
    const match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
}

function renderVideos() {
    const grid = document.getElementById('video-grid');
    if (!grid) return;
    grid.innerHTML = '';
    
    if (LEARN_VIDEOS.length === 0) {
        grid.innerHTML = `
            <div class="col-span-full flex flex-col items-center justify-center text-gray-500 py-20">
                <i class="fab fa-youtube text-4xl mb-3 opacity-50"></i>
                <p class="text-xs uppercase tracking-widest">No videos configured</p>
            </div>
        `;
        return;
    }

    LEARN_VIDEOS.forEach(video => {
        const videoId = getYouTubeId(video.url);
        if (!videoId) return;
        
        const card = document.createElement('div');
        card.className = 'bg-[#0a0a15] rounded-2xl overflow-hidden border border-white/5 hover:border-theme-primary-50 transition-all group relative hover:-translate-y-1 hover:shadow-2xl';
        
        // Changed: Opens in new tab instead of modal
        card.innerHTML = `
            <a href="${video.url}" target="_blank" class="block aspect-video relative overflow-hidden cursor-pointer">
                <img src="https://img.youtube.com/vi/${videoId}/maxresdefault.jpg" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" onerror="this.src='https://img.youtube.com/vi/${videoId}/hqdefault.jpg'">
                <div class="absolute inset-0 bg-black/20 group-hover:bg-black/0 transition-colors flex items-center justify-center">
                    <div class="w-12 h-12 rounded-full bg-theme-primary flex items-center justify-center backdrop-blur-sm opacity-0 group-hover:opacity-100 transition-all scale-50 group-hover:scale-100 shadow-lg shadow-theme-primary">
                        <i class="fas fa-external-link-alt text-white ml-1"></i>
                    </div>
                </div>
            </a>
            <div class="p-4">
                <h4 class="text-white font-bold text-sm line-clamp-2 leading-relaxed mb-2">${video.title || 'Untitled Video'}</h4>
                <div class="flex justify-between items-center mt-3 pt-3 border-t border-white/5">
                    <span class="text-[10px] text-gray-500 font-mono uppercase">Youtube</span>
                    <span class="text-[10px] text-theme-primary font-bold uppercase tracking-wider">WATCH NOW</span>
                </div>
            </div>
        `;
        grid.appendChild(card);
    });
}
    </script>
</body>
</html></html>






















































































